<!DOCTYPE html>  <html> <head>   <title>ticks.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.html">                 base.coffee               </a>                                           <a class="source" href="bokeh_model.html">                 bokeh_model.coffee               </a>                                           <a class="source" href="bokeh_views.html">                 bokeh_views.coffee               </a>                                           <a class="source" href="coffee_style_guide.html">                 coffee_style_guide.coffee               </a>                                           <a class="source" href="model_base.html">                 model_base.coffee               </a>                                           <a class="source" href="testutils.html">                 testutils.coffee               </a>                                           <a class="source" href="ticks.html">                 ticks.coffee               </a>                                           <a class="source" href="tools.html">                 tools.coffee               </a>                                           <a class="source" href="ui_model.html">                 ui_model.coffee               </a>                                           <a class="source" href="ui_view.html">                 ui_view.coffee               </a>                                           <a class="source" href="view_base.html">                 view_base.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               ticks.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <hr />

<p>Written by: David C. Morrill (based on similar routines written by Eric Jones)</p>

<p>Date: 2007-05-01</p>

<p>(c) Copyright 2002-7 by Enthought, Inc.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre><span class="s">&quot;&quot;&quot; Tick generator classes and helper functions for calculating axis</span>
<span class="s">tick-related values (i.e., bounds and intervals).</span>

<span class="s">&quot;&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Major library imports
from numpy import arange, argsort, array, ceil, concatenate, equal, finfo, \
   float64, floor, linspace, log10, minimum, ndarray, newaxis, \
   putmask, shape</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Enthought library imports
from traits.api import HasTraits, Any</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>class AbstractTickGenerator(HasTraits):</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">AbstractTickGenerator</span>
    <span class="s">&quot;&quot;&quot; Abstract class for tick generators.</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="nv">get_ticks: </span>
      <span class="nf">(data_low, data_high, bounds_low, bounds_high, interval,\</span>
<span class="nf">      use_endpoints=False, scale=&#39;linear&#39;) -&gt;</span>
        <span class="s">&quot;&quot;&quot; Returns a list of ticks points in data space.</span>

<span class="s">        Parameters</span>
<span class="s">        ----------</span>
<span class="s">        data_low, data_high : float</span>
<span class="s">            The actual minimum and maximum of index values of the entire</span>
<span class="s">            dataset.</span>
<span class="s">        bounds_low, bounds_high : &quot;auto&quot;, &quot;fit&quot;, float</span>
<span class="s">            The range for which ticks should be generated.</span>
<span class="s">        interval : &quot;auto&quot;, float</span>
<span class="s">            If the value is a positive number, it specifies the length</span>
<span class="s">            of the tick interval; a negative integer specifies the</span>
<span class="s">            number of tick intervals; &#39;auto&#39; specifies that the number and</span>
<span class="s">            length of the tick intervals are automatically calculated, based</span>
<span class="s">            on the range of the axis.</span>
<span class="s">        use_endpoints : Boolean</span>
<span class="s">            If True, the lower and upper bounds of the data are used as the</span>
<span class="s">            lower and upper end points of the axis. If False, the end points</span>
<span class="s">            might not fall exactly on the bounds.</span>
<span class="s">        scale : &#39;linear&#39; or &#39;log&#39;</span>
<span class="s">            The type of scale the ticks are for.</span>

<span class="s">        Returns</span>
<span class="s">        -------</span>
<span class="s">        tick_list : array of floats</span>
<span class="s">            Where ticks are to be placed.</span>


<span class="s">        Example</span>
<span class="s">        -------</span>
<span class="s">        If the range of x-values in a line plot span from -15.0 to +15.0, but</span>
<span class="s">        the plot is currently displaying only the region from 3.1 to 6.83, and</span>
<span class="s">        the user wants the interval to be automatically computed to be some</span>
<span class="s">        nice value, then call get_ticks() thusly::</span>

<span class="s">            get_ticks(-15.0, 15.0, 3.1, 6.83, &quot;auto&quot;)</span>

<span class="s">        A reasonable return value in this case would be::</span>

<span class="s">            [3.5, 4.0, 4.5, 5.0, 5.5, 6.0, 6.5]</span>
<span class="s">        &quot;&quot;&quot;</span>

      


<span class="k">class</span> <span class="nx">DefaultTickGenerator</span> <span class="k">extends</span> <span class="nx">AbstractTickGenerator</span>
    <span class="s">&quot;&quot;&quot; An implementation of AbstractTickGenerator that simply uses the</span>
<span class="s">    auto_ticks() and log_auto_ticks() functions.</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="nv">get_ticks : </span><span class="nf">(data_low, data_high, bounds_low,\</span>
<span class="nf">      bounds_high, interval, use_endpoints=False, scale=&#39;linear&#39;) -&gt;</span>
        <span class="k">if</span> <span class="nx">scale</span> <span class="o">==</span> <span class="s">&#39;linear&#39;</span>
            <span class="s">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>FIXME
return array(auto<em>ticks(data</em>low, data<em>high, bounds</em>low, bounds<em>high,
            interval, use</em>endpoints=False), float64)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">elif</span> <span class="nx">scale</span> <span class="o">==</span> <span class="s">&#39;log&#39;</span><span class="o">:</span>
            <span class="s">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>FIXME
return array(log<em>auto</em>ticks(data<em>low, data</em>high, bounds<em>low, bounds</em>high,
                                 interval, use_endpoints=False), float64)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ShowAllTickGenerator</span> <span class="k">extends</span> <span class="nx">AbstractTickGenerator</span> 
    <span class="s">&quot;&quot;&quot; Uses the abstract interface, but returns all &quot;positions&quot; instead</span>
<span class="s">        of decimating the ticks.</span>

<span class="s">        You must provide a sequence of values as a *positions* keyword argument</span>
<span class="s">        to the constructor.</span>
<span class="s">    &quot;&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>A sequence of positions for ticks.
positions = Any</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">get_ticks : </span><span class="nf">(data_low, data_high, bounds_low, bounds_high, interval,\</span>
<span class="nf">      use_endpoints=False, scale=&#39;linear&#39;) -&gt;</span>
        <span class="s">&quot;&quot;&quot; Returns an array based on **positions**.</span>
<span class="s">        &quot;&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>ignore all the high, low, etc. data and just return every position</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>FIXME
return array(self.positions, float64)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <hr />

<h2> Code imported from plt/plot_utility.py:</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">auto_ticks = </span> <span class="nf">( data_low, data_high, bound_low, bound_high, tick_interval,\</span>
<span class="nf">                 use_endpoints = true) -&gt;</span>
    <span class="s">&quot;&quot;&quot; Finds locations for axis tick marks.</span>

<span class="s">        Calculates the locations for tick marks on an axis. The *bound_low*,</span>
<span class="s">        *bound_high*, and *tick_interval* parameters specify how the axis end</span>
<span class="s">        points and tick interval are calculated.</span>

<span class="s">        Parameters</span>
<span class="s">        ----------</span>

<span class="s">        data_low, data_high : number</span>
<span class="s">            The minimum and maximum values of the data along this axis.</span>
<span class="s">            If any of the bound settings are &#39;auto&#39; or &#39;fit&#39;, the axis</span>
<span class="s">            traits are calculated automatically from these values.</span>
<span class="s">        bound_low, bound_high : &#39;auto&#39;, &#39;fit&#39;, or a number.</span>
<span class="s">            The lower and upper bounds of the axis. If the value is a number,</span>
<span class="s">            that value is used for the corresponding end point. If the value is</span>
<span class="s">            &#39;auto&#39;, then the end point is calculated automatically. If the</span>
<span class="s">            value is &#39;fit&#39;, then the axis bound is set to the corresponding</span>
<span class="s">            *data_low* or *data_high* value.</span>
<span class="s">        tick_interval : can be &#39;auto&#39; or a number</span>
<span class="s">            If the value is a positive number, it specifies the length</span>
<span class="s">            of the tick interval; a negative integer specifies the</span>
<span class="s">            number of tick intervals; &#39;auto&#39; specifies that the number and</span>
<span class="s">            length of the tick intervals are automatically calculated, based</span>
<span class="s">            on the range of the axis.</span>
<span class="s">        use_endpoints : Boolean</span>
<span class="s">            If True, the lower and upper bounds of the data are used as the</span>
<span class="s">            lower and upper end points of the axis. If False, the end points</span>
<span class="s">            might not fall exactly on the bounds.</span>

<span class="s">        Returns</span>
<span class="s">        -------</span>
<span class="s">        An array of tick mark locations. The first and last tick entries are the</span>
<span class="s">        axis end points.</span>
<span class="s">    &quot;&quot;&quot;</span>

    <span class="nv">is_auto_low  = </span><span class="p">(</span><span class="nx">bound_low</span>  <span class="o">==</span> <span class="s">&#39;auto&#39;</span><span class="p">)</span>
    <span class="nv">is_auto_high = </span><span class="p">(</span><span class="nx">bound_high</span> <span class="o">==</span> <span class="s">&#39;auto&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">bound_low</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span>
        <span class="nv">lower = </span><span class="nx">data_low</span>
    <span class="k">else</span>
        <span class="nv">lower = </span><span class="nx">bound_low</span>

    <span class="k">if</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">bound_high</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span>
        <span class="nv">upper = </span><span class="nx">data_high</span>
    <span class="k">else</span>
        <span class="nv">upper = </span><span class="nx">bound_high</span> 

    <span class="k">if</span> <span class="p">(</span><span class="nx">tick_interval</span> <span class="o">==</span> <span class="s">&#39;auto&#39;</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">tick_interval</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="nv">rng = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span> <span class="nx">upper</span> <span class="o">-</span> <span class="nx">lower</span> <span class="p">)</span>

        <span class="k">if</span> <span class="nx">rng</span> <span class="o">==</span> <span class="mf">0.0</span>
            <span class="nv">tick_interval = </span><span class="mf">0.5</span>
            <span class="nv">lower         = </span><span class="nx">data_low</span>  <span class="o">-</span> <span class="mf">0.5</span>
            <span class="nv">upper         = </span><span class="nx">data_high</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">is_base2</span><span class="p">(</span> <span class="nx">rng</span> <span class="p">)</span> <span class="o">and</span> <span class="nx">is_base2</span><span class="p">(</span> <span class="nx">upper</span> <span class="p">)</span> <span class="o">and</span> <span class="nx">rng</span> <span class="o">&gt;</span> <span class="mi">4</span>
            <span class="k">if</span> <span class="nx">rng</span> <span class="o">==</span> <span class="mi">2</span>
                <span class="nv">tick_interval = </span><span class="mi">1</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">rng</span> <span class="o">==</span> <span class="mi">4</span>
                <span class="nv">tick_interval = </span><span class="mi">4</span>
            <span class="k">else</span>
                <span class="nv">tick_interval = </span><span class="nx">rng</span> <span class="o">/</span> <span class="mi">4</span>   <span class="c1"># maybe we want it 8?</span>
        <span class="k">else</span>
            <span class="nv">tick_interval = </span><span class="nx">auto_interval</span><span class="p">(</span> <span class="nx">lower</span><span class="p">,</span> <span class="nx">upper</span> <span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">tick_interval</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="nv">intervals     = </span><span class="o">-</span><span class="nx">tick_interval</span>
        <span class="nv">tick_interval = </span><span class="nx">tick_intervals</span><span class="p">(</span> <span class="nx">lower</span><span class="p">,</span> <span class="nx">upper</span><span class="p">,</span> <span class="nx">intervals</span> <span class="p">)</span>
        <span class="k">if</span> <span class="nx">is_auto_low</span> <span class="o">and</span> <span class="nx">is_auto_high</span>
            <span class="nv">is_auto_low = is_auto_high = </span><span class="kc">false</span>
            <span class="nv">lower = </span><span class="nx">tick_interval</span> <span class="o">*</span> <span class="nx">floor</span><span class="p">(</span> <span class="nx">lower</span> <span class="o">/</span> <span class="nx">tick_interval</span> <span class="p">)</span>
            <span class="k">while</span> <span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span> <span class="nx">lower</span> <span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">tick_interval</span><span class="p">)</span> <span class="o">and</span>
                   <span class="p">((</span><span class="nx">lower</span> <span class="o">+</span> <span class="nx">tick_interval</span> <span class="o">*</span> <span class="p">(</span><span class="nx">intervals</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="nx">upper</span><span class="p">))</span>
                <span class="nx">lower</span> <span class="o">-=</span> <span class="nx">tick_interval</span>
            <span class="nv">upper = </span><span class="nx">lower</span> <span class="o">+</span> <span class="nx">tick_interval</span> <span class="o">*</span> <span class="nx">intervals</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If the lower or upper bound are set to 'auto',
calculate them based on the newly chosen tick_interval:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">is_auto_low</span> <span class="o">or</span> <span class="nx">is_auto_high</span>
        <span class="nv">delta = </span><span class="mf">0.01</span> <span class="o">*</span> <span class="nx">tick_interval</span> <span class="o">*</span> <span class="p">(</span><span class="nx">data_low</span> <span class="o">==</span> <span class="nx">data_high</span><span class="p">)</span>
        <span class="p">[</span><span class="nx">auto_lower</span><span class="p">,</span> <span class="nx">auto_upper</span><span class="p">]</span> <span class="o">=</span> <span class="nx">auto_bounds</span><span class="p">(</span>
            <span class="nx">data_low</span> <span class="o">-</span> <span class="nx">delta</span><span class="p">,</span> <span class="nx">data_high</span> <span class="o">+</span> <span class="nx">delta</span><span class="p">,</span> <span class="nx">tick_interval</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">is_auto_low</span>
            <span class="nv">lower = </span><span class="nx">auto_lower</span>
        <span class="k">if</span> <span class="nx">is_auto_high</span>
            <span class="nv">upper = </span><span class="nx">auto_upper</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Compute the range of ticks values:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">start = </span><span class="nx">floor</span><span class="p">(</span> <span class="nx">lower</span> <span class="o">/</span> <span class="nx">tick_interval</span> <span class="p">)</span> <span class="o">*</span> <span class="nx">tick_interval</span>
    <span class="nv">end   = </span><span class="nx">floor</span><span class="p">(</span> <span class="nx">upper</span> <span class="o">/</span> <span class="nx">tick_interval</span> <span class="p">)</span> <span class="o">*</span> <span class="nx">tick_interval</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>If we return the same value for the upper bound and lower bound, the
layout code will not be able to lay out the tick marks (divide by zero).</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">start</span> <span class="o">==</span> <span class="nx">end</span>
        <span class="nv">lower = start = </span><span class="nx">start</span> <span class="o">-</span> <span class="nx">tick_interval</span>
        <span class="nv">upper = end = </span><span class="nx">start</span> <span class="o">-</span> <span class="nx">tick_interval</span>

    <span class="k">if</span> <span class="nx">upper</span> <span class="o">&gt;</span> <span class="nx">end</span>
        <span class="nx">end</span> <span class="o">+=</span> <span class="nx">tick_interval</span>
    <span class="nv">ticks = </span><span class="nx">arange</span><span class="p">(</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="o">+</span> <span class="p">(</span><span class="nx">tick_interval</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="nx">tick_interval</span> <span class="p">)</span>

    <span class="k">if</span> <span class="nx">len</span><span class="p">(</span> <span class="nx">ticks</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span>
        <span class="s">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>FIXME
ticks = array( ( ( lower - lower * 1.0e-7 ), lower ) )</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">is_auto_low</span><span class="p">)</span> <span class="o">and</span> <span class="nx">use_endpoints</span>
        <span class="nx">ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">lower</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">is_auto_high</span><span class="p">)</span> <span class="o">and</span> <span class="nx">use_endpoints</span>
        <span class="nx">ticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">upper</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>FIXME</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="p">[</span><span class="nx">tick</span> <span class="k">for</span> <span class="nx">tick</span> <span class="k">in</span> <span class="nx">ticks</span> <span class="k">if</span> <span class="nx">tick</span> <span class="o">&gt;=</span> <span class="nx">bound_low</span> <span class="o">and</span> <span class="nx">tick</span> <span class="o">&lt;=</span> <span class="nx">bound_high</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <hr />

<h2> Determine if a number is a power of 2:</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">is_base2 = </span><span class="nf">(range) -&gt;</span>
    <span class="s">&quot;&quot;&quot; Returns True if *range* is a positive base-2 number (2, 4, 8, 16, ...).</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nx">range</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">else</span>
        <span class="nv">lg = </span><span class="nx">log2</span><span class="p">(</span><span class="nx">range</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="nx">lg</span> <span class="o">==</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="nx">lg</span> <span class="p">))</span> <span class="o">and</span> <span class="p">(</span><span class="nx">lg</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">))</span>

<span class="nv">log10 = </span><span class="nf">(num) -&gt;</span>
  <span class="k">if</span> <span class="nx">num</span> <span class="o">==</span> <span class="mf">0.0</span>
    <span class="nx">num</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="nx">e</span><span class="o">-</span><span class="mi">16</span>

  <span class="k">return</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span><span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <hr />

<h2> Compute n log 2:</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">log2 = </span><span class="nf">(num) -&gt;</span>
    <span class="s">&quot;&quot;&quot; Returns the base 2 logarithm of a number (or array).</span>

<span class="s">    &quot;&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>!! 1e-16 is here to prevent errors when log is 0</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">num</span> <span class="o">==</span> <span class="mf">0.0</span>
        <span class="nx">num</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="nx">e</span><span class="o">-</span><span class="mi">16</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>elif type( num ) is ndarray:
   putmask( num, equal( num, 0.0), 1.0e-16 )</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>return log10( num ) / log10( 2 )</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <hr />

<h2> Compute the best tick interval for a specified data range:</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">heckbert_interval = </span><span class="nf">(data_low, data_high, numticks=8) -&gt;</span>
    <span class="s">&quot;&quot;&quot;</span>
<span class="s">    Returns a &quot;nice&quot; range and interval for a given data range and a preferred</span>
<span class="s">    number of ticks.  From Paul Heckbert&#39;s algorithm in Graphics Gems.</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="nv">range = </span><span class="nx">_nice</span><span class="p">(</span><span class="nx">data_high</span> <span class="o">-</span> <span class="nx">data_low</span><span class="p">)</span>
    <span class="nv">d = </span><span class="nx">_nice</span><span class="p">(</span><span class="nx">range</span> <span class="o">/</span> <span class="p">(</span><span class="nx">numticks</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="kc">true</span><span class="p">)</span>
    <span class="nv">graphmin = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">data_low</span> <span class="o">/</span> <span class="nx">d</span><span class="p">)</span> <span class="o">*</span> <span class="nx">d</span>
    <span class="nv">graphmax = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">data_high</span> <span class="o">/</span> <span class="nx">d</span><span class="p">)</span> <span class="o">*</span> <span class="nx">d</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>nfrac = max(-Math.floor(log10(d)), 0)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="p">[</span><span class="nx">graphmin</span><span class="p">,</span> <span class="nx">graphmax</span><span class="p">,</span> <span class="nx">d</span><span class="p">]</span>


<span class="nv">_nice = </span><span class="nf">(x, round=false) -&gt;</span>
    <span class="s">&quot;&quot;&quot; if round is false, then use Math.ceil(range) &quot;&quot;&quot;</span>
    <span class="nv">expv = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">log10</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span>
    <span class="nv">f = </span><span class="nx">x</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">expv</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">round</span>
        <span class="k">if</span> <span class="nx">f</span> <span class="o">&lt;</span> <span class="mf">1.5</span>
            <span class="nv">nf = </span><span class="mf">1.0</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">f</span> <span class="o">&lt;</span> <span class="mf">3.0</span>
            <span class="nv">nf = </span><span class="mf">2.0</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">f</span> <span class="o">&lt;</span> <span class="mf">7.0</span>
            <span class="nv">nf = </span><span class="mf">5.0</span>
        <span class="k">else</span>
            <span class="nv">nf = </span><span class="mf">10.0</span>
    <span class="k">else</span>
        <span class="k">if</span> <span class="nx">f</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
            <span class="nv">nf = </span><span class="mf">1.0</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">f</span> <span class="o">&lt;=</span> <span class="mf">2.0</span>
            <span class="nv">nf = </span><span class="mf">2.0</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">f</span> <span class="o">&lt;=</span> <span class="mf">5.0</span>
            <span class="nv">nf = </span><span class="mf">5.0</span>
        <span class="k">else</span>
            <span class="nv">nf = </span><span class="mf">10.0</span>
    <span class="k">return</span> <span class="nx">nf</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">expv</span><span class="p">)</span>

<span class="nv">arange = </span><span class="nf">(start, end=false, step=false) -&gt;</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">end</span>
    <span class="nv">end = </span><span class="nx">start</span>
    <span class="nv">start = </span><span class="mi">0</span>
  <span class="k">if</span> <span class="nx">start</span> <span class="o">&gt;</span> <span class="nx">end</span>
    <span class="k">if</span> <span class="nx">step</span> <span class="o">==</span> <span class="kc">false</span>
      <span class="nv">step = </span><span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">step</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="s">&quot;the loop will never terminate&quot;</span>
        <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">step</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="s">&quot;the loop will never terminate&quot;</span>
    <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
  <span class="k">if</span> <span class="o">not</span> <span class="nx">step</span>
    <span class="nv">step = </span><span class="mi">1</span>

  <span class="nv">ret_arr = </span><span class="p">[]</span>
  <span class="nv">i = </span><span class="nx">start</span>
  <span class="k">if</span> <span class="nx">start</span> <span class="o">&lt;</span> <span class="nx">end</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">end</span>
      <span class="nx">ret_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="nx">step</span>
  <span class="k">else</span>
    <span class="k">while</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="nx">end</span>
      <span class="nx">ret_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="nx">step</span>
  <span class="k">return</span> <span class="nx">ret_arr</span>

<span class="nv">arr_div = </span><span class="nf">(numerators, denominator) -&gt;</span>
  <span class="nv">output_arr = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="nx">numerators</span>
    <span class="nx">output_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="o">/</span><span class="nx">denominator</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">output_arr</span>

<span class="nv">arr_div2 = </span><span class="nf">(numerator, denominators) -&gt;</span>
  <span class="nv">output_arr = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="nx">denominators</span>
    <span class="nx">output_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">numerator</span><span class="o">/</span><span class="nx">val</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">output_arr</span>


<span class="nv">arr_div3 = </span><span class="nf">(numerators, denominators) -&gt;</span>
  <span class="nv">output_arr = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">denominators</span>
    <span class="nx">output_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">numerators</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">/</span><span class="nx">val</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">output_arr</span>

<span class="nv">arr_pow2 = </span><span class="nf">(base, exponents) -&gt;</span>
  <span class="nv">output_arr = </span><span class="p">[]</span>
  <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="nx">exponents</span>
    <span class="nx">output_arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">val</span><span class="p">))</span>
  <span class="k">return</span> <span class="nx">output_arr</span>



<span class="nb">window</span><span class="p">.</span><span class="nv">_.sorted = </span><span class="nf">(arr) -&gt;</span>
  <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">identity</span><span class="p">)</span>


<span class="nb">window</span><span class="p">.</span><span class="nv">argsort = </span><span class="nf">(arr) -&gt;</span>
  <span class="nv">sorted_arr = </span>  <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">identity</span><span class="p">)</span>
  <span class="nv">ret_arr = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>for y, i in arr
 ret<em>arr[i] = sorted</em>arr.indexOf(y)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">sorted_arr</span>
    <span class="nx">ret_arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>ret<em>arr.push(sorted</em>arr.indexOf(y))</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">ret_arr</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>window.argsort = (arr) ->
 arr.map((x) -> _.sortedIndex(arr, x))
_.sortedIndex</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">auto_interval = </span><span class="nf">(data_low, data_high) -&gt;</span>
    <span class="s">&quot;&quot;&quot; Calculates the tick interval for a range.</span>

<span class="s">        The boundaries for the data to be plotted on the axis are::</span>

<span class="s">            data_bounds = (data_low,data_high)</span>

<span class="s">        The function chooses the number of tick marks, which can be between</span>
<span class="s">        3 and 9 marks (including end points), and chooses tick intervals at</span>
<span class="s">        1, 2, 2.5, 5, 10, 20, ...</span>

<span class="s">        Returns</span>
<span class="s">        -------</span>
<span class="s">        interval : float</span>
<span class="s">            tick mark interval for axis</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="nv">range = </span><span class="nx">float</span><span class="p">(</span> <span class="nx">data_high</span> <span class="p">)</span> <span class="o">-</span> <span class="nx">float</span><span class="p">(</span> <span class="nx">data_low</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>We'll choose from between 2 and 8 tick marks.
Preference is given to more ticks:
  Note reverse order and see kludge below...
divisions = arange( 8.0, 2.0, -1.0 ) # ( 7, 6, ..., 3 )</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">divisions = </span><span class="p">[</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Calculate the intervals for the divisions:
candidate_intervals = range / divisions</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">candidate_intervals = </span><span class="nx">arr_div2</span><span class="p">(</span><span class="nx">range</span><span class="p">,</span> <span class="nx">divisions</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Get magnitudes and mantissas for each candidate:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">magnitudes = </span><span class="nx">candidate_intervals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nf">(candidate) -&gt;</span>
      <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">log10</span><span class="p">(</span><span class="nx">candidate</span><span class="p">))))</span>
    <span class="nv">mantissas  = </span><span class="nx">arr_div3</span><span class="p">(</span><span class="nx">candidate_intervals</span><span class="p">,</span> <span class="nx">magnitudes</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>List of "pleasing" intervals between ticks on graph.
Only the first magnitude are listed, higher mags others are inferred:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">magic_intervals = </span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span> <span class="p">]</span>


    <span class="nv">best_mantissas = </span><span class="p">[]</span>
    <span class="nv">best_magics = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">mi</span> <span class="k">in</span> <span class="nx">magic_intervals</span>
      <span class="nv">diff_arr = </span><span class="nx">mantissas</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nf">(x) -&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">mi</span> <span class="o">-</span> <span class="nx">x</span><span class="p">))</span>
      <span class="nx">best_magics</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">diff_arr</span><span class="p">))</span>
    <span class="k">for</span> <span class="nx">ma</span> <span class="k">in</span> <span class="nx">mantissas</span>
      <span class="nv">diff_arr = </span><span class="nx">magic_intervals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nf">(x) -&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">ma</span> <span class="o">-</span> <span class="nx">x</span><span class="p">))</span>
      <span class="nx">best_mantissas</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">diff_arr</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Calculate the absolute differences between the candidates
(with magnitude removed) and the magic intervals:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Find the division and magic interval combo that produce the
smallest differences:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">magic_index    = </span><span class="nx">argsort</span><span class="p">(</span><span class="nx">best_magics</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nv">mantissa_index = </span><span class="nx">argsort</span><span class="p">(</span><span class="nx">best_mantissas</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>The best interval is the magic_interval multiplied by the magnitude
of the best mantissa:</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">interval  = </span><span class="nx">magic_intervals</span><span class="p">[</span> <span class="nx">magic_index</span> <span class="p">]</span>
    <span class="nv">magnitude = </span><span class="nx">magnitudes</span><span class="p">[</span> <span class="nx">mantissa_index</span> <span class="p">]</span>
    <span class="nv">result    = </span><span class="nx">interval</span> <span class="o">*</span> <span class="nx">magnitude</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>if result == 0.0
   result = finfo(float).eps</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">result</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <hr />

<p>Compute the best tick interval length to achieve a specified number of tick</p>

<h2> intervals:</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">float = </span><span class="nf">(x) -&gt;</span>
  <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mf">0.0</span>
<span class="nb">window</span><span class="p">.</span><span class="nv">tick_intervals = </span> <span class="nf">( data_low, data_high, intervals ) -&gt;</span>
    <span class="s">&quot;&quot;&quot; Computes the best tick interval length to achieve a specified number of</span>
<span class="s">    tick intervals.</span>

<span class="s">    Parameters</span>
<span class="s">    ----------</span>
<span class="s">    data_low, data_high : number</span>
<span class="s">        The minimum and maximum values of the data along this axis.</span>
<span class="s">        If any of the bound settings are &#39;auto&#39; or &#39;fit&#39;, the axis</span>
<span class="s">        traits are calculated automatically from these values.</span>
<span class="s">    intervals : number</span>
<span class="s">        The desired number of intervals</span>

<span class="s">    Returns</span>
<span class="s">    -------</span>
<span class="s">    Returns a float indicating the tick interval length.</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="nv">range     = </span><span class="nx">float</span><span class="p">(</span> <span class="nx">data_high</span> <span class="o">-</span> <span class="nx">data_low</span> <span class="p">)</span>
    <span class="k">if</span> <span class="nx">range</span> <span class="o">==</span> <span class="mf">0.0</span>
        <span class="nv">range = </span><span class="mf">1.0</span>
    <span class="nv">interval  = </span><span class="nx">range</span> <span class="o">/</span> <span class="nx">intervals</span>
    <span class="nv">exp_ = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="nx">log10</span><span class="p">(</span> <span class="nx">interval</span> <span class="p">)</span> <span class="p">)</span>

    <span class="nv">factor    = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">exp_</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;exp_ </span><span class="si">#{</span><span class="nx">exp_</span><span class="si">}</span><span class="s">  pre_factor </span><span class="si">#{</span><span class="nx">factor</span><span class="si">}</span><span class="s"> pre_interval </span><span class="si">#{</span><span class="nx">interval</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="nv">interval = </span><span class="nx">interval</span> <span class="o">/</span> <span class="nx">factor</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot; factor </span><span class="si">#{</span><span class="nx">factor</span><span class="si">}</span><span class="s"> initial_interval </span><span class="si">#{</span><span class="nx">interval</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">interval</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
        <span class="nv">interval = </span><span class="mf">2.0</span>
        <span class="nv">index    = </span><span class="mi">0</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">interval</span> <span class="o">&lt;</span> <span class="mf">2.5</span>
        <span class="nv">interval = </span><span class="mf">2.5</span>
        <span class="nv">index    = </span><span class="mi">1</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">interval</span> <span class="o">&lt;</span> <span class="mf">5.0</span>
        <span class="nv">interval = </span><span class="mf">5.0</span>
        <span class="nv">index    = </span><span class="mi">2</span>
    <span class="k">else</span>
        <span class="nv">interval = </span><span class="mf">10.0</span>
        <span class="nv">index    = </span><span class="mi">3</span>

    <span class="k">while</span> <span class="kc">true</span>

        <span class="nv">result = </span><span class="nx">interval</span> <span class="o">*</span> <span class="nx">factor</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;result </span><span class="si">#{</span><span class="nx">result</span><span class="si">}</span><span class="s"> index </span><span class="si">#{</span><span class="nx">index</span><span class="si">}</span><span class="s"> interval </span><span class="si">#{</span><span class="nx">interval</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="nx">data_low</span> <span class="o">/</span> <span class="nx">result</span> <span class="p">)</span> <span class="o">*</span> <span class="nx">result</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">intervals</span> <span class="o">*</span> <span class="nx">result</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">data_high</span>
            <span class="k">return</span> <span class="nx">result</span>
        <span class="nv">index     = </span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>
        <span class="nv">interval  = </span><span class="nx">interval</span> <span class="o">*</span>  <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span> <span class="p">[</span> <span class="nx">index</span> <span class="p">]</span>


<span class="s">&quot;&quot;&quot;</span>
<span class="s">I&#39;ll worry about this after getting linear ticks working</span>
<span class="s">log_auto_ticks = (data_low, data_high,</span>
<span class="s">                   bound_low, bound_high,</span>
<span class="s">                   tick_interval, use_endpoints=true) -&gt;</span>

<span class="err">#</span><span class="s">DIVIDER</span>
<span class="s">    tick_goal = 15</span>
<span class="s">    magic_numbers = [1, 2, 5]</span>
<span class="s">    explicit_ticks = false</span>

<span class="s">    if data_low &lt;= 0.0</span>
<span class="s">        return []</span>

<span class="s">    if tick_interval != &#39;auto&#39;</span>
<span class="s">        if tick_interval &lt; 0</span>
<span class="s">            tick_goal = -tick_interval</span>
<span class="s">        else</span>
<span class="s">            magic_numbers = [tick_interval]</span>
<span class="s">            explicit_ticks = true</span>

<span class="s">    if data_low&gt;data_high</span>
<span class="s">        [data_low, data_high] = data_high, data_low</span>

<span class="s">    log_low = log10(data_low)</span>
<span class="s">    log_high = log10(data_high)</span>
<span class="s">    log_interval = log_high-log_low</span>

<span class="s">    if log_interval &lt; 1.0</span>

<span class="err">#</span><span class="s">DIVIDER</span>
<span class="s">        return auto_ticks(data_low, data_high,</span>
<span class="s">                          bound_low, bound_high,</span>
<span class="s">                          tick_interval,</span>
<span class="s">                          use_endpoints = false)</span>

<span class="s">    else if log_interval &lt; (tick_goal+1)/2 or explicit_ticks</span>

<span class="err">#</span><span class="s">DIVIDER</span>


<span class="err">#</span><span class="s">DIVIDER</span>
<span class="s">        for interval in magic_numbers</span>
<span class="s">            ticklist = []</span>
<span class="s">            for exp in [Math.floor(log_low).,Math.ceil(log_high)]</span>
<span class="s">                for multiplier in linspace(interval, 10.0, round(10.0/interval),</span>
<span class="s">                                           endpoint=1)</span>
<span class="s">                    tick = Math.exp(10, exp*multiplier)</span>
<span class="s">                    if tick &gt;= data_low and tick &lt;= data_high:</span>
<span class="s">                        ticklist.append(tick)</span>
<span class="s">            if len(ticklist)&lt;tick_goal+3 or explicit_ticks:</span>
<span class="s">                return ticklist</span>
<span class="s">    else:</span>

<span class="err">#</span><span class="s">DIVIDER</span>
<span class="s">        startlog = Math.ceil(log_low)</span>
<span class="s">        endlog = Math.floor(log_high)</span>
<span class="s">        interval = Math.ceil((endlog-startlog)/9.0)</span>
<span class="s">        expticks = arange(startlog, endlog, interval)</span>

<span class="err">#</span><span class="s">DIVIDER</span>
<span class="s">        if (endlog-startlog) % interval == 0.0:</span>
<span class="s">            expticks = concatenate([expticks, [endlog]])</span>
<span class="s">        return 10**expticks</span>
<span class="s">&quot;&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Like auto_ticks(), but for log scales.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">auto_bounds = </span><span class="nf">( data_low, data_high, tick_interval ) -&gt;</span>
    <span class="s">&quot;&quot;&quot; Calculates appropriate upper and lower bounds for the axis from</span>
<span class="s">        the data bounds and the given axis interval.</span>

<span class="s">        The boundaries  hit either exactly on the lower and upper values</span>
<span class="s">        or on the tick mark just beyond the lower and upper values.</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">calc_bound</span><span class="p">(</span> <span class="nx">data_low</span><span class="p">,</span>  <span class="nx">tick_interval</span><span class="p">,</span> <span class="kc">false</span> <span class="p">),</span>
             <span class="nx">calc_bound</span><span class="p">(</span> <span class="nx">data_high</span><span class="p">,</span> <span class="nx">tick_interval</span><span class="p">,</span> <span class="kc">true</span>  <span class="p">)</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>If less than a factor of 10 separates the data, just use the normal
linear approach</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">divmod = </span><span class="nf">(x,y) -&gt;</span>
  <span class="nv">quot = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">x</span><span class="o">/</span><span class="nx">y</span><span class="p">)</span>
  <span class="nv">rem = </span><span class="nx">x</span> <span class="o">%</span> <span class="nx">y</span>

  <span class="k">return</span> <span class="p">[</span><span class="nx">quot</span><span class="p">,</span> <span class="nx">rem</span><span class="p">]</span>
  
<span class="nb">window</span><span class="p">.</span><span class="nv">calc_bound = </span> <span class="nf">( end_point, tick_interval, is_upper ) -&gt;</span>
    <span class="s">&quot;&quot;&quot; Finds an axis end point that includes the value *end_point*.</span>

<span class="s">    If the tick mark interval results in a tick mark hitting directly on the</span>
<span class="s">    end point, *end_point* is returned.  Otherwise, the location of the tick</span>
<span class="s">    mark just past *end_point* is returned. The *is_upper* parameter</span>
<span class="s">    specifies whether *end_point* is at the upper (True) or lower (false)</span>
<span class="s">    end of the axis.</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="p">[</span><span class="nx">quotient</span><span class="p">,</span> <span class="nx">remainder</span><span class="p">]</span> <span class="o">=</span> <span class="nx">divmod</span><span class="p">(</span> <span class="nx">end_point</span><span class="p">,</span> <span class="nx">tick_interval</span> <span class="p">)</span>
    <span class="nv">rem_p = </span><span class="nx">remainder</span> <span class="o">==</span> <span class="mf">0.0</span>
    <span class="nv">tick_p = </span><span class="p">((</span><span class="nx">tick_interval</span> <span class="o">-</span> <span class="nx">remainder</span><span class="p">)</span> <span class="o">/</span> <span class="nx">tick_interval</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span>
    <span class="k">if</span> <span class="nx">rem_p</span> <span class="o">or</span> <span class="nx">tick_p</span>
        <span class="k">return</span> <span class="nx">end_point</span>

    <span class="nv">c1 = </span><span class="p">(</span><span class="nx">quotient</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="nx">tick_interval</span>
    <span class="nv">c2 = </span><span class="nx">quotient</span>         <span class="o">*</span> <span class="nx">tick_interval</span>
    <span class="k">if</span> <span class="nx">is_upper</span>
        <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span> <span class="nx">c1</span><span class="p">,</span> <span class="nx">c2</span> <span class="p">)</span>

<span class="nb">window</span><span class="p">.</span><span class="nv">ticks = </span><span class="p">{}</span>
<span class="nv">ticks.auto_interval = </span><span class="nx">auto_interval</span>
<span class="nv">ticks.auto_bounds = </span><span class="nx">auto_bounds</span>

</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>If there's enough space, try to put lines at the magic number multipliers
inside each power of ten</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Try each interval to see how many ticks we get</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>We put lines at every power of ten or less</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>There's no function that is like arange but inclusive, so
we have to check whether the endpoint should be included.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <hr />

<h2> Compute the best lower and upper axis bounds for a range of data:</h2>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <hr />

<h2> Compute the best axis endpoint for a specified data value:</h2>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 