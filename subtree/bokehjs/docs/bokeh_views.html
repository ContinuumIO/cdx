<!DOCTYPE html>  <html> <head>   <title>bokeh_views.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.html">                 base.coffee               </a>                                           <a class="source" href="bokeh_model.html">                 bokeh_model.coffee               </a>                                           <a class="source" href="bokeh_views.html">                 bokeh_views.coffee               </a>                                           <a class="source" href="coffee_style_guide.html">                 coffee_style_guide.coffee               </a>                                           <a class="source" href="model_base.html">                 model_base.coffee               </a>                                           <a class="source" href="testutils.html">                 testutils.coffee               </a>                                           <a class="source" href="ticks.html">                 ticks.coffee               </a>                                           <a class="source" href="tools.html">                 tools.coffee               </a>                                           <a class="source" href="ui_model.html">                 ui_model.coffee               </a>                                           <a class="source" href="ui_view.html">                 ui_view.coffee               </a>                                           <a class="source" href="view_base.html">                 view_base.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               bokeh_views.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">Bokeh</span>
  <span class="nv">Bokeh = </span><span class="k">this</span><span class="p">.</span><span class="nx">Bokeh</span>
<span class="k">else</span>
  <span class="nv">Bokeh = </span><span class="p">{}</span>
  <span class="k">this</span><span class="p">.</span><span class="nv">Bokeh = </span><span class="nx">Bokeh</span>
<span class="nv">safebind = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">safebind</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>class : PlotWidget</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">PlotWidget</span> <span class="k">extends</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">ContinuumView</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Everything that lives inside a plot container should
inherit from this class.  All plot widgets are
passed in the plot model and view
This class also contains some basic canvas rendering primitives
we also include the request_render function, which
calls a throttled version of the plot canvas rendering function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tagName : </span><span class="s">&#39;div&#39;</span>
  <span class="nv">marksize : </span><span class="mi">3</span>
  <span class="nv">initialize : </span><span class="nf">(options) -&gt;</span>
    <span class="vi">@plot_model = </span><span class="nx">options</span><span class="p">.</span><span class="nx">plot_model</span>
    <span class="vi">@plot_view = </span><span class="nx">options</span><span class="p">.</span><span class="nx">plot_view</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

  <span class="nv">bind_bokeh_events : </span><span class="o">-&gt;</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nf">()-&gt;</span>
        <span class="nx">@request_render</span><span class="p">())</span>

  <span class="nv">addPolygon: </span><span class="nf">(x,y) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">@marksize</span><span class="p">,</span><span class="nx">@marksize</span><span class="p">)</span>

  <span class="nv">addCircle: </span><span class="nf">(x,y) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">@marksize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

  <span class="nv">request_render : </span><span class="nf">() -&gt;</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">throttled</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>###class : GridPlotContainerView</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">GridPlotContainerView</span> <span class="k">extends</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">ContinuumView</span>
  <span class="nv">tagName : </span><span class="s">&#39;div&#39;</span>
  <span class="nx">className</span><span class="o">:</span><span class="s">&quot;gridplot_container&quot;</span>
  <span class="nv">default_options : </span><span class="p">{</span> <span class="nx">scale</span><span class="o">:</span><span class="mf">1.0</span><span class="p">}</span>
  <span class="nv">set_child_view_states : </span><span class="nf">() -&gt;</span>
    <span class="nv">viewstates = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;children&#39;</span><span class="p">)</span>
      <span class="nv">viewstaterow = </span><span class="p">(</span><span class="nx">@childviews</span><span class="p">[</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">viewstate</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">row</span><span class="p">)</span>
      <span class="nx">viewstates</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">viewstaterow</span><span class="p">)</span>
    <span class="nx">@viewstate</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s">&#39;childviewstates&#39;</span><span class="p">,</span> <span class="nx">viewstates</span><span class="p">)</span>

  <span class="nv">initialize : </span><span class="nf">(options) -&gt;</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">@default_options</span><span class="p">))</span>
    <span class="vi">@viewstate = </span><span class="k">new</span> <span class="nx">Bokeh</span><span class="p">.</span><span class="nx">GridViewState</span><span class="p">();</span>
    <span class="vi">@childviews = </span><span class="p">{}</span>
    <span class="nx">@build_children</span><span class="p">()</span>
    <span class="nx">@render</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">this</span>

  <span class="nv">bind_bokeh_events : </span><span class="o">-&gt;</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change:children&#39;</span><span class="p">,</span> <span class="nx">@build_children</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@viewstate</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;destroy&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@remove</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>FIXME make binding of this style equivalent to above safebind calls
document semantics of when these events should be bound
bokeh events</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">b_events : </span><span class="p">{</span>
    <span class="s">&quot;change:children model&quot;</span> <span class="o">:</span> <span class="s">&quot;build_children&quot;</span><span class="p">,</span>
    <span class="s">&quot;change model&quot;</span><span class="o">:</span>           <span class="s">&quot;render&quot;</span><span class="p">,</span>
    <span class="s">&quot;change viewstate&quot;</span>      <span class="o">:</span> <span class="s">&quot;render&quot;</span><span class="p">,</span>
    <span class="s">&quot;destroy model&quot;</span>         <span class="o">:</span> <span class="s">&quot;remove&quot;</span><span class="p">}</span>


  <span class="nv">build_children : </span><span class="o">-&gt;</span>
    <span class="nv">childmodels = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;children&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="nx">plot</span> <span class="k">in</span> <span class="nx">row</span>
        <span class="nx">childmodels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">plot</span><span class="p">)</span>
    <span class="nx">build_views</span><span class="p">(</span><span class="nx">@childviews</span><span class="p">,</span> <span class="nx">childmodels</span><span class="p">,</span> <span class="p">{})</span>
    <span class="nx">@set_child_view_states</span><span class="p">()</span>

  <span class="nv">render : </span><span class="o">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">view</span> <span class="k">in</span> <span class="nx">_</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">@childviews</span><span class="p">)</span>
      <span class="nx">view</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">detach</span><span class="p">()</span>
    <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="nv">row_heights = </span> <span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;layout_heights&#39;</span><span class="p">)</span>
    <span class="nv">col_widths = </span> <span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;layout_widths&#39;</span><span class="p">)</span>
    <span class="nv">y_coords = </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">reduceRight</span><span class="p">(</span><span class="nx">row_heights</span><span class="p">[</span><span class="mi">1</span><span class="p">..]</span>
      <span class="p">,</span>
        <span class="nf">(x, y) -&gt;</span>
          <span class="nv">val = </span><span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span>
          <span class="nx">y_coords</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
          <span class="k">return</span> <span class="nx">val</span>
      <span class="p">,</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="nx">y_coords</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nv">x_coords = </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">col_widths</span><span class="p">[..</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="p">,</span>
        <span class="nf">(x,y) -&gt;</span>
          <span class="nv">val = </span><span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span>
          <span class="nx">x_coords</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
          <span class="k">return</span> <span class="nx">val</span>
      <span class="p">,</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="nv">plot_divs = </span><span class="p">[]</span>
    <span class="nv">last_plot = </span><span class="kc">null</span>
    <span class="k">for</span> <span class="nx">row</span><span class="p">,</span> <span class="nx">ridx</span> <span class="k">in</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;children&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="nx">plotspec</span><span class="p">,</span> <span class="nx">cidx</span> <span class="k">in</span> <span class="nx">row</span>
        <span class="nv">view = </span><span class="nx">@childviews</span><span class="p">[</span><span class="nx">plotspec</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
        <span class="nv">ypos = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">position_child_y</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;outerheight&#39;</span><span class="p">),</span>
          <span class="nx">y_coords</span><span class="p">[</span><span class="nx">ridx</span><span class="p">])</span>
        <span class="nv">xpos = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">position_child_x</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;outerwidth&#39;</span><span class="p">),</span>
          <span class="nx">x_coords</span><span class="p">[</span><span class="nx">cidx</span><span class="p">])</span>
        <span class="nv">plot_wrapper = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;div class=&#39;gp_plotwrapper&#39;&gt;&lt;/div&gt;&quot;</span><span class="p">)</span>
        <span class="nx">plot_wrapper</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span>
          <span class="s">&#39;style&#39;</span><span class="p">,</span>
          <span class="s">&quot;left:</span><span class="si">#{</span><span class="nx">xpos</span><span class="si">}</span><span class="s">px; top:</span><span class="si">#{</span><span class="nx">ypos</span><span class="si">}</span><span class="s">px&quot;</span><span class="p">)</span>
        <span class="nx">plot_wrapper</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">$el</span><span class="p">)</span>
        <span class="nx">@$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">plot_wrapper</span><span class="p">)</span>
    <span class="nv">height = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;outerheight&#39;</span><span class="p">)</span>
    <span class="nv">width = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;outerwidth&#39;</span><span class="p">)</span>
    <span class="nx">@$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span> <span class="s">&quot;height:</span><span class="si">#{</span><span class="nx">height</span><span class="si">}</span><span class="s">px;width:</span><span class="si">#{</span><span class="nx">width</span><span class="si">}</span><span class="s">px&quot;</span><span class="p">)</span>
    <span class="nx">@render_end</span><span class="p">()</span>

<span class="k">class</span> <span class="nx">ActiveToolManager</span>
  <span class="s">&quot;&quot;&quot; This makes sure that only one tool is active at a time &quot;&quot;&quot;</span>
  <span class="nv">constructor : </span><span class="nf">(eventSink) -&gt;</span>
    <span class="vi">@eventSink = </span><span class="nx">eventSink</span>
    <span class="vi">@eventSink.active = </span><span class="kc">true</span>
    <span class="nx">@bind_events</span><span class="p">()</span>

  <span class="nv">bind_events : </span><span class="nf">() -&gt;</span>
    <span class="nx">@eventSink</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">&quot;clear_active_tool&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span>
      <span class="nx">@eventSink</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@eventSink</span><span class="p">.</span><span class="nx">active</span><span class="si">}</span><span class="s">:deactivated&quot;</span><span class="p">)</span>
      <span class="vi">@eventSink.active = </span><span class="kc">true</span><span class="p">)</span>
    <span class="nx">@eventSink</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">&quot;active_tool&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">toolName</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">toolName</span> <span class="o">!=</span> <span class="nx">@eventSink</span><span class="p">.</span><span class="nx">active</span>
        <span class="nx">@eventSink</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">toolName</span><span class="si">}</span><span class="s">:activated&quot;</span><span class="p">)</span>
        <span class="nx">@eventSink</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@eventSink</span><span class="p">.</span><span class="nx">active</span><span class="si">}</span><span class="s">:deactivated&quot;</span><span class="p">)</span>
        <span class="vi">@eventSink.active = </span><span class="nx">toolName</span><span class="p">)</span>

<span class="k">class</span> <span class="nx">PlotView</span> <span class="k">extends</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">ContinuumView</span>
  <span class="nv">default_options : </span><span class="p">{</span><span class="nx">scale</span><span class="o">:</span><span class="mf">1.0</span><span class="p">}</span>

  <span class="nv">view_options : </span><span class="o">-&gt;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nv">plot_model : </span><span class="nx">@model</span><span class="p">,</span> <span class="nv">plot_view : </span><span class="nx">@</span><span class="p">},</span> <span class="nx">@options</span><span class="p">)</span>

  <span class="nv">build_renderers : </span><span class="o">-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;before&#39;</span><span class="p">)</span>
    <span class="nx">build_views</span><span class="p">(</span><span class="nx">@renderers</span><span class="p">,</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;renderers&#39;</span><span class="p">),</span> <span class="nx">@view_options</span><span class="p">())</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;after&#39;</span><span class="p">)</span>

  <span class="nv">build_axes : </span><span class="o">-&gt;</span>
    <span class="nx">build_views</span><span class="p">(</span><span class="nx">@axes</span><span class="p">,</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;axes&#39;</span><span class="p">),</span> <span class="nx">@view_options</span><span class="p">())</span>

  <span class="nv">build_tools : </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>build<em>views(@model, @tools, @mget('tools'), @model</em>specs())</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">build_views</span><span class="p">(</span><span class="nx">@tools</span><span class="p">,</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;tools&#39;</span><span class="p">),</span> <span class="nx">@view_options</span><span class="p">())</span>

  <span class="nv">build_overlays : </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>add ids of renderer views into the overlay spec</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">build_views</span><span class="p">(</span><span class="nx">@overlays</span><span class="p">,</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;overlays&#39;</span><span class="p">),</span> <span class="nx">@view_options</span><span class="p">())</span>

  <span class="nv">bind_overlays : </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">overlayspec</span> <span class="k">in</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;overlays&#39;</span><span class="p">)</span>
      <span class="nx">@overlays</span><span class="p">[</span><span class="nx">overlayspec</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">bind_events</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

  <span class="nv">bind_tools : </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">toolspec</span> <span class="k">in</span>   <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;tools&#39;</span><span class="p">)</span>
      <span class="nx">@tools</span><span class="p">[</span><span class="nx">toolspec</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">bind_events</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

  <span class="nv">tagName : </span><span class="s">&#39;div&#39;</span>

  <span class="nv">events :</span>
    <span class="s">&quot;mousemove .main_can_wrapper&quot;</span> <span class="o">:</span> <span class="s">&quot;_mousemove&quot;</span>
    <span class="s">&quot;mousedown .main_can_wrapper&quot;</span> <span class="o">:</span> <span class="s">&quot;_mousedown&quot;</span>

  <span class="nv">_mousedown : </span><span class="nf">(e) -&gt;</span>
    <span class="k">for</span> <span class="nx">f</span> <span class="k">in</span> <span class="nx">@mousedownCallbacks</span>
      <span class="nx">f</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerY</span><span class="p">)</span>

  <span class="nv">_mousemove : </span><span class="nf">(e) -&gt;</span>
    <span class="k">for</span> <span class="nx">f</span> <span class="k">in</span> <span class="nx">@moveCallbacks</span>
      <span class="nx">f</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">layerY</span><span class="p">)</span>


  <span class="nv">initialize : </span><span class="nf">(options) -&gt;</span>
    <span class="vi">@throttled = </span><span class="nx">_</span><span class="p">.</span><span class="nx">throttle</span><span class="p">(</span><span class="nx">@render_deferred_components</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">@default_options</span><span class="p">))</span>
    <span class="nv">height = </span><span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="k">then</span> <span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>
    <span class="nv">width = </span><span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="k">then</span> <span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">)</span>
    <span class="nv">offset = </span><span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">offset</span> <span class="k">then</span> <span class="nx">options</span><span class="p">.</span><span class="nx">offset</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;offset&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">border_space</span>
      <span class="nv">border_space = </span><span class="nx">options</span><span class="p">.</span><span class="nx">border_space</span>
    <span class="k">else</span>
      <span class="nv">border_space = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;border_space&#39;</span><span class="p">)</span>
    <span class="vi">@viewstate = </span><span class="k">new</span> <span class="nx">Bokeh</span><span class="p">.</span><span class="nx">ViewState</span><span class="p">(</span>
      <span class="nv">height : </span><span class="nx">height</span>
      <span class="nv">width : </span><span class="nx">width</span>
      <span class="nv">offset : </span><span class="nx">offset</span>
      <span class="nv">border_space : </span><span class="nx">border_space</span>
    <span class="p">)</span>
    <span class="vi">@renderers = </span><span class="p">{}</span>
    <span class="vi">@axes = </span><span class="p">{}</span>
    <span class="vi">@tools = </span><span class="p">{}</span>
    <span class="vi">@overlays = </span><span class="p">{}</span>
    <span class="vi">@eventSink = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">)</span>
    <span class="nv">atm = </span><span class="k">new</span> <span class="nx">ActiveToolManager</span><span class="p">(</span><span class="nx">@eventSink</span><span class="p">)</span>
    <span class="vi">@moveCallbacks = </span><span class="p">[]</span>
    <span class="vi">@mousedownCallbacks = </span><span class="p">[]</span>
    <span class="vi">@keydownCallbacks = </span><span class="p">[]</span>
    <span class="nx">@render_init</span><span class="p">()</span>
    <span class="nx">@render</span><span class="p">()</span>
    <span class="nx">@build_subviews</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">render_init : </span><span class="nf">() -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>FIXME template</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      &lt;div class=&#39;button_bar&#39;/&gt;</span>
<span class="s">      &lt;div class=&#39;all_can_wrapper&#39;&gt;</span>

<span class="s">        &lt;div class=&#39;main_can_wrapper can_wrapper&#39;&gt;</span>
<span class="s">          &lt;div class=&#39;_shader&#39; /&gt;</span>
<span class="s">          &lt;canvas class=&#39;main_can&#39;&gt;&lt;/canvas&gt;</span>
<span class="s">        &lt;/div&gt;</span>
<span class="s">        &lt;div class=&#39;x_can_wrapper can_wrapper&#39;&gt;</span>
<span class="s">            &lt;canvas class=&#39;x_can&#39;&gt;&lt;/canvas&gt;</span>
<span class="s">        &lt;/div&gt;</span>
<span class="s">        &lt;div class=&#39;y_can_wrapper can_wrapper&#39;&gt;</span>
<span class="s">          &lt;canvas class=&#39;y_can&#39;&gt;&lt;/canvas&gt;</span>
<span class="s">        &lt;/div&gt;</span>
<span class="s">      &lt;/div&gt;</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">))</span>
    <span class="nx">@$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;plot_wrap&quot;</span><span class="p">)</span>
    <span class="vi">@canvas = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;canvas.main_can&#39;</span><span class="p">)</span>
    <span class="vi">@x_can = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;canvas.x_can&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="vi">@y_can = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;canvas.y_can&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="vi">@main_can_wrapper = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;.main_can_wrapper&#39;</span><span class="p">)</span>
    <span class="vi">@x_can_wrapper = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;.x_can_wrapper&#39;</span><span class="p">)</span>
    <span class="vi">@y_can_wrapper = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;.y_can_wrapper&#39;</span><span class="p">)</span>

  <span class="nv">build_subviews : </span><span class="nf">()-&gt;</span>
    <span class="nx">@build_renderers</span><span class="p">()</span>
    <span class="nx">@build_axes</span><span class="p">()</span>
    <span class="nx">@build_tools</span><span class="p">()</span>
    <span class="nx">@build_overlays</span><span class="p">()</span>
    <span class="nx">@bind_tools</span><span class="p">()</span>
    <span class="nx">@bind_overlays</span><span class="p">()</span>


  <span class="nv">bind_bokeh_events : </span><span class="nf">() -&gt;</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@viewstate</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change:renderers&#39;</span><span class="p">,</span> <span class="nx">@build_renderers</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change:axes&#39;</span><span class="p">,</span> <span class="nx">@build_axes</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change:tools&#39;</span><span class="p">,</span> <span class="nx">@build_tools</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@viewstate</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;destroy&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@remove</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>FIXME document throughly when render is called vs render<em>deferred
should we have a "render</em>init" "render" and a
"render<em>canvas" function add</em>dom is called at instatiation.
"render" is called for plot resizing.  render<em>canvas is called
when changes to the canvas are desired.  A ScatterRendererView
would only have a "render</em>canvas function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render : </span><span class="nf">() -&gt;</span>
    <span class="nv">height = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>
    <span class="nv">width = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">)</span>
    <span class="nv">border_space = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;border_space&#39;</span><span class="p">)</span>
    <span class="nv">outerheight = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;outerheight&#39;</span><span class="p">)</span>
    <span class="nv">outerwidth = </span><span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;outerwidth&#39;</span><span class="p">)</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nx">@$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;width&quot;</span><span class="p">,</span> <span class="nx">outerwidth</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">,</span> <span class="nx">outerheight</span><span class="p">)</span>
    <span class="nv">bord = </span><span class="nx">border_space</span>
    <span class="nv">xcw = </span><span class="nx">@x_can_wrapper</span>
    <span class="nv">w = </span><span class="nx">width</span>
    <span class="nv">h = </span><span class="nx">height</span>

    <span class="nv">o_w = </span><span class="nx">outerwidth</span>
    <span class="nv">o_h = </span><span class="nx">outerheight</span>
    <span class="nx">@main_can_wrapper</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span> <span class="s">&quot;left:</span><span class="si">#{</span><span class="nx">bord</span><span class="si">}</span><span class="s">px; height:</span><span class="si">#{</span><span class="nx">h</span><span class="si">}</span><span class="s">px; width:</span><span class="si">#{</span><span class="nx">w</span><span class="si">}</span><span class="s">px&quot;</span><span class="p">)</span>
    <span class="nx">@x_can_wrapper</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span> <span class="s">&quot;left:</span><span class="si">#{</span><span class="nx">bord</span><span class="si">}</span><span class="s">px; top:</span><span class="si">#{</span><span class="nx">h</span><span class="si">}</span><span class="s">px; height:</span><span class="si">#{</span><span class="nx">bord</span><span class="si">}</span><span class="s">px; width:</span><span class="si">#{</span><span class="nx">w</span><span class="si">}</span><span class="s">px&quot;</span><span class="p">)</span>
    <span class="nx">@y_can_wrapper</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span> <span class="s">&quot;width:</span><span class="si">#{</span><span class="nx">bord</span><span class="si">}</span><span class="s">px; height:</span><span class="si">#{</span><span class="nx">h</span><span class="si">}</span><span class="s">px;&quot;</span><span class="p">)</span>


    <span class="nx">@$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;height:</span><span class="si">#{</span><span class="nx">o_h</span><span class="si">}</span><span class="s">px; width:</span><span class="si">#{</span><span class="nx">o_w</span><span class="si">}</span><span class="s">px&quot;</span><span class="p">)</span>
    <span class="nv">wh = </span><span class="nf">(el, w, h) -&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">,</span><span class="nx">h</span><span class="p">)</span>
    <span class="nx">wh</span><span class="p">(</span><span class="nx">@canvas</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
    <span class="nx">wh</span><span class="p">(</span><span class="nx">@x_can</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">bord</span><span class="p">)</span>
    <span class="nx">wh</span><span class="p">(</span><span class="nx">@y_can</span><span class="p">,</span> <span class="nx">bord</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>

    <span class="vi">@x_can_ctx = </span><span class="nx">@x_can</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&#39;2d&#39;</span><span class="p">)</span>
    <span class="vi">@y_can_ctx = </span><span class="nx">@y_can</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&#39;2d&#39;</span><span class="p">)</span>
    <span class="vi">@ctx = </span><span class="nx">@canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&#39;2d&#39;</span><span class="p">)</span>
    <span class="nx">@render_end</span><span class="p">()</span>

  <span class="nv">render_deferred_components: </span><span class="nf">(force) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>console.log("plotview render deferred components", @constructor, new Date() - 1)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">all_views = </span><span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">([</span><span class="nx">@tools</span><span class="p">,</span> <span class="nx">@axes</span><span class="p">,</span> <span class="nx">@renderers</span><span class="p">,</span> <span class="nx">@overlays</span><span class="p">],</span> <span class="nx">_</span><span class="p">.</span><span class="nx">values</span><span class="p">))</span>
    <span class="nx">@ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>  <span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">),</span> <span class="nx">@viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">all_views</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>

<span class="nv">build_views = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">build_views</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>class : XYRendererView</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">XYRendererView</span> <span class="k">extends</span> <span class="nx">PlotWidget</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>This class is the base class for  all 2d renderers
half of it is for setting up mappers,
The other half (<code>@select</code>,  and <code>@calc_buffer</code>)
only make sense for our schema based renderers
(line/scatter) because the glyph renderer allows
for specifying data space and
screen space offsets, which aren't handled in those methods.
so we probably need to split this up somehow</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize : </span><span class="nf">(options) -&gt;</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="nx">@set_xmapper</span><span class="p">()</span>
    <span class="nx">@set_ymapper</span><span class="p">()</span>

  <span class="nv">bind_bokeh_events : </span><span class="nf">() -&gt;</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">),</span> <span class="s">&#39;change:data&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change:xdata_range&#39;</span><span class="p">,</span> <span class="nx">@set_xmapper</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change:ydata_range&#39;</span><span class="p">,</span> <span class="nx">@set_ymapper</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;xdata_range&#39;</span><span class="p">),</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;ydata_range&#39;</span><span class="p">),</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>

  <span class="nv">set_xmapper : </span><span class="nf">() -&gt;</span>
    <span class="vi">@xmapper = </span><span class="k">new</span> <span class="nx">Bokeh</span><span class="p">.</span><span class="nx">LinearMapper</span><span class="p">({},</span>
      <span class="nv">data_range : </span><span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;xdata_range&#39;</span><span class="p">)</span>
      <span class="nv">viewstate : </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span>
      <span class="nv">screendim : </span><span class="s">&#39;width&#39;</span>
    <span class="p">)</span>
    <span class="nx">@request_render</span><span class="p">()</span>

  <span class="nv">set_ymapper: </span><span class="nf">() -&gt;</span>
    <span class="vi">@ymapper = </span><span class="k">new</span> <span class="nx">Bokeh</span><span class="p">.</span><span class="nx">LinearMapper</span><span class="p">({},</span>
      <span class="nv">data_range : </span><span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;ydata_range&#39;</span><span class="p">)</span>
      <span class="nv">viewstate : </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span>
      <span class="nv">screendim : </span><span class="s">&#39;height&#39;</span>
    <span class="p">)</span>
    <span class="nx">@request_render</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3>method : XYRendererView::select</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">select : </span><span class="nf">(xscreenbounds, yscreenbounds) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>given x/y screen coordinates, select
points on the data source that fall within
these bounds.  This does not work for glyph
based renderers</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">xscreenbounds</span>
      <span class="nv">mapper = </span><span class="nx">@xmapper</span>
      <span class="nv">xdatabounds = </span><span class="p">[</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">map_data</span><span class="p">(</span><span class="nx">xscreenbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="nx">mapper</span><span class="p">.</span><span class="nx">map_data</span><span class="p">(</span><span class="nx">xscreenbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">else</span>
      <span class="nv">xdatabounds = </span><span class="kc">null</span>
    <span class="k">if</span> <span class="nx">yscreenbounds</span>
      <span class="nv">mapper = </span><span class="nx">@ymapper</span>
      <span class="nv">ydatabounds = </span><span class="p">[</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">map_data</span><span class="p">(</span><span class="nx">yscreenbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="nx">mapper</span><span class="p">.</span><span class="nx">map_data</span><span class="p">(</span><span class="nx">yscreenbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">else</span>
      <span class="nv">ydatabounds = </span><span class="kc">null</span>
    <span class="nv">func = </span><span class="nf">(xval, yval) -&gt;</span>
      <span class="nv">val = </span><span class="p">((</span><span class="nx">xdatabounds</span> <span class="o">is</span> <span class="kc">null</span><span class="p">)</span> <span class="o">or</span>
        <span class="p">(</span><span class="nx">xval</span> <span class="o">&gt;</span> <span class="nx">xdatabounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">and</span> <span class="nx">xval</span> <span class="o">&lt;</span> <span class="nx">xdatabounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">and</span>
          <span class="p">((</span><span class="nx">ydatabounds</span> <span class="o">is</span> <span class="kc">null</span><span class="p">)</span> <span class="o">or</span>
          <span class="p">(</span><span class="nx">yval</span> <span class="o">&gt;</span> <span class="nx">ydatabounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">and</span> <span class="nx">yval</span> <span class="o">&lt;</span> <span class="nx">ydatabounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="k">return</span> <span class="nx">val</span>
    <span class="nv">source = </span><span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">source</span><span class="p">.</span><span class="nx">select</span><span class="p">([</span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;xfield&#39;</span><span class="p">),</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;yfield&#39;</span><span class="p">)],</span> <span class="nx">func</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>method : XYRendererView::calc_buffer</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">calc_buffer : </span><span class="nf">(data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>calculates screen coordinates for data.  Only works
for schema based renderers(line/scatter)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&quot;use strict&quot;</span><span class="p">;</span>
    <span class="nv">pv = </span><span class="nx">@plot_view</span>
    <span class="nv">pvo = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">options</span>
    <span class="nv">own_options = </span><span class="nx">@options</span>
    <span class="nv">xfield = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;xfield&#39;</span><span class="p">)</span>
    <span class="nv">yfield = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;yfield&#39;</span><span class="p">)</span>

    <span class="nv">datax = </span><span class="p">(</span><span class="nx">x</span><span class="p">[</span><span class="nx">xfield</span><span class="p">]</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span>
    <span class="nv">screenx = </span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">v_map_screen</span><span class="p">(</span><span class="nx">datax</span><span class="p">)</span>
    <span class="nv">screenx = </span><span class="nx">pv</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">v_xpos</span><span class="p">(</span><span class="nx">screenx</span><span class="p">)</span>

    <span class="nv">datay = </span><span class="p">(</span><span class="nx">y</span><span class="p">[</span><span class="nx">yfield</span><span class="p">]</span> <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span>
    <span class="nv">screeny = </span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">v_map_screen</span><span class="p">(</span><span class="nx">datay</span><span class="p">)</span>
    <span class="nv">screeny = </span><span class="nx">pv</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">v_ypos</span><span class="p">(</span><span class="nx">screeny</span><span class="p">)</span>

    <span class="vi">@screeny = </span><span class="nx">screeny</span>
    <span class="vi">@screenx = </span><span class="nx">screenx</span>

<span class="k">class</span> <span class="nx">LinearAxisView</span> <span class="k">extends</span> <span class="nx">PlotWidget</span>
  <span class="nv">initialize : </span><span class="nf">(options) -&gt;</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="vi">@plot_view = </span><span class="nx">options</span><span class="p">.</span><span class="nx">plot_view</span>
    <span class="k">if</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;orientation&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;top&#39;</span> <span class="o">or</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;orientation&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;bottom&#39;</span>
      <span class="vi">@screendim = </span><span class="s">&#39;width&#39;</span>
    <span class="k">else</span>
      <span class="vi">@screendim = </span><span class="s">&#39;height&#39;</span>
    <span class="nx">@set_mapper</span><span class="p">()</span>

  <span class="nv">bind_bokeh_events : </span><span class="nf">() -&gt;</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@plot_model</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@model</span><span class="p">,</span> <span class="s">&#39;change:data_range&#39;</span><span class="p">,</span> <span class="nx">@set_mapper</span><span class="p">)</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;data_range&#39;</span><span class="p">),</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>

  <span class="nv">set_mapper : </span><span class="nf">() -&gt;</span>
    <span class="vi">@mapper = </span><span class="k">new</span> <span class="nx">Bokeh</span><span class="p">.</span><span class="nx">LinearMapper</span><span class="p">({},</span>
      <span class="nv">data_range : </span><span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;data_range&#39;</span><span class="p">)</span>
      <span class="nv">viewstate : </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span>
      <span class="nv">screendim : </span><span class="s">&#39;height&#39;</span>
    <span class="p">)</span>
    <span class="nx">@request_render</span><span class="p">()</span>

  <span class="nv">tagName : </span><span class="s">&#39;div&#39;</span>
  <span class="nv">get_offsets : </span><span class="nf">(orientation) -&gt;</span>
    <span class="nv">offsets =</span>
      <span class="nv">x : </span><span class="mi">0</span>
      <span class="nv">y : </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">orientation</span> <span class="o">==</span> <span class="s">&#39;bottom&#39;</span>
      <span class="nx">offsets</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">offsets</span>

  <span class="nv">get_tick_size : </span><span class="nf">(orientation) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNull</span><span class="p">(</span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;tickSize&#39;</span><span class="p">)))</span>
      <span class="k">return</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;tickSize&#39;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">orientation</span> <span class="o">==</span> <span class="s">&#39;bottom&#39;</span>
        <span class="k">return</span> <span class="o">-</span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="o">-</span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">)</span>

  <span class="nv">render : </span><span class="o">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nv">unselected_color = </span><span class="s">&quot;</span><span class="err">#</span><span class="s">ccc&quot;</span>
    <span class="vi">@plot_view.ctx.fillStyle = </span><span class="nx">unselected_color</span>
    <span class="vi">@plot_view.ctx.strokeStyle = </span><span class="nx">unselected_color</span>
    <span class="k">if</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;orientation&#39;</span><span class="p">)</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="s">&#39;top&#39;</span><span class="p">]</span>
      <span class="nx">@render_x</span><span class="p">()</span>
      <span class="nx">@render_end</span><span class="p">()</span>
      <span class="k">return</span>
    <span class="nx">@render_y</span><span class="p">()</span>
    <span class="nx">@render_end</span><span class="p">()</span>
    <span class="k">return</span>

  <span class="nv">tick_label : </span><span class="nf">(tick) -&gt;</span>
    <span class="k">return</span> <span class="nx">tick</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

  <span class="nv">render_x : </span><span class="o">-&gt;</span>
    <span class="nv">can_ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">x_can_ctx</span>
    <span class="nv">data_range = </span><span class="nx">@mapper</span><span class="p">.</span><span class="nx">data_range</span>
    <span class="nv">interval = </span><span class="nx">ticks</span><span class="p">.</span><span class="nx">auto_interval</span><span class="p">(</span>
      <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">),</span> <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="nv">range = </span><span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span>
    <span class="nv">x_scale = </span><span class="nx">@mapper</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;scalestate&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nv">last_tick_end = </span><span class="mi">10000</span>
    <span class="p">[</span><span class="nx">first_tick</span><span class="p">,</span> <span class="nx">last_tick</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ticks</span><span class="p">.</span><span class="nx">auto_bounds</span><span class="p">(</span>
      <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">),</span> <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">),</span> <span class="nx">interval</span><span class="p">)</span>
    <span class="nv">current_tick = </span><span class="nx">first_tick</span>
    <span class="nv">x_ticks = </span><span class="p">[]</span>
    <span class="nv">last_tick_end = </span><span class="mi">0</span>
    <span class="nx">can_ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">),</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">))</span>
    <span class="k">while</span> <span class="nx">current_tick</span> <span class="o">&lt;=</span> <span class="nx">last_tick</span>
      <span class="nx">x_ticks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">current_tick</span><span class="p">)</span>
      <span class="nv">text_width = </span><span class="nx">can_ctx</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="nx">@tick_label</span><span class="p">(</span><span class="nx">current_tick</span><span class="p">)).</span><span class="nx">width</span>
      <span class="nv">x = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@mapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">current_tick</span><span class="p">))</span>
      <span class="nv">txtpos = </span><span class="p">(</span> <span class="nx">x</span> <span class="o">-</span> <span class="p">(</span><span class="nx">text_width</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
      <span class="k">if</span> <span class="nx">txtpos</span> <span class="o">&gt;</span> <span class="nx">last_tick_end</span>
        <span class="nx">can_ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">@tick_label</span><span class="p">(</span><span class="nx">current_tick</span><span class="p">),</span> <span class="nx">txtpos</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="nv">last_tick_end = </span><span class="p">(</span><span class="nx">txtpos</span> <span class="o">+</span> <span class="nx">text_width</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">))</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="nx">current_tick</span> <span class="o">+=</span> <span class="nx">interval</span>
    <span class="nx">can_ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">@render_end</span><span class="p">()</span>

  <span class="nv">DEFAULT_TEXT_HEIGHT : </span><span class="mi">8</span>
  <span class="nv">render_y : </span><span class="o">-&gt;</span>
    <span class="nv">can_ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">y_can_ctx</span>
    <span class="nv">data_range = </span><span class="nx">@mapper</span><span class="p">.</span><span class="nx">data_range</span>
    <span class="nv">interval = </span><span class="nx">ticks</span><span class="p">.</span><span class="nx">auto_interval</span><span class="p">(</span>
      <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">),</span> <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">))</span>
    <span class="nv">range = </span><span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span>
    <span class="nv">y_scale = </span><span class="nx">@mapper</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;scalestate&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">[</span><span class="nx">first_tick</span><span class="p">,</span> <span class="nx">last_tick</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ticks</span><span class="p">.</span><span class="nx">auto_bounds</span><span class="p">(</span>
      <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">),</span> <span class="nx">data_range</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">),</span> <span class="nx">interval</span><span class="p">)</span>
    <span class="nv">current_tick = </span><span class="nx">first_tick</span>
    <span class="nv">y_ticks = </span><span class="p">[]</span>
    <span class="nv">last_tick_end = </span><span class="mi">10000</span>
    <span class="nx">can_ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">),</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">))</span>
    <span class="k">while</span> <span class="nx">current_tick</span> <span class="o">&lt;=</span> <span class="nx">last_tick</span>
      <span class="nx">y_ticks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">current_tick</span><span class="p">)</span>
      <span class="nv">y = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@mapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">current_tick</span><span class="p">))</span>
      <span class="nv">txtpos = </span><span class="p">(</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">@DEFAULT_TEXT_HEIGHT</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
      <span class="k">if</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">last_tick_end</span>
        <span class="nx">can_ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">@tick_label</span><span class="p">(</span><span class="nx">current_tick</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
        <span class="nv">last_tick_end = </span><span class="p">(</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">@DEFAULT_TEXT_HEIGHT</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">),</span> <span class="nx">y</span><span class="p">)</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
      <span class="nx">current_tick</span> <span class="o">+=</span> <span class="nx">interval</span>
    <span class="nx">can_ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">@render_end</span><span class="p">()</span>

<span class="k">class</span> <span class="nx">LinearDateAxisView</span> <span class="k">extends</span> <span class="nx">LinearAxisView</span>
  <span class="nv">tick_label : </span><span class="nf">(tick) -&gt;</span>
    <span class="nv">start = </span><span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;data_range&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span>
    <span class="nv">end = </span><span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;data_range&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
    <span class="nv">one_day = </span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span><span class="mi">1000</span>
    <span class="nv">tick = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">tick</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">))</span>  <span class="o">&gt;</span> <span class="p">(</span><span class="nx">one_day</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">tick</span><span class="p">.</span><span class="nx">toLocaleDateString</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="nx">tick</span><span class="p">.</span><span class="nx">toLocaleTimeString</span><span class="p">()</span>

<span class="k">class</span> <span class="nx">LineRendererView</span> <span class="k">extends</span> <span class="nx">XYRendererView</span>
  <span class="nv">render : </span><span class="o">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="nv">data = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
    <span class="nx">@calc_buffer</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

    <span class="vi">@plot_view.ctx.fillStyle = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;foreground_color&#39;</span><span class="p">)</span>
    <span class="vi">@plot_view.ctx.strokeStyle = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;foreground_color&#39;</span><span class="p">)</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">@screenx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">@screeny</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="nx">@screenx</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
      <span class="nv">x = </span><span class="nx">@screenx</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span>
      <span class="nv">y = </span><span class="nx">@screeny</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
        <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
        <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="k">continue</span>
      <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">@render_end</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>class : GlyphRendererView</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">GlyphRendererView</span> <span class="k">extends</span> <span class="nx">XYRendererView</span>
  <span class="nv">addSquare: </span><span class="nf">(x, y, size, color) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="vi">@plot_view.ctx.fillStyle = </span><span class="nx">color</span>
    <span class="vi">@plot_view.ctx.strokeStyle = </span><span class="nx">color</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">y</span> <span class="o">-</span> <span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>

  <span class="nv">addCircle: </span><span class="nf">(x, y, size, color) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="vi">@plot_view.ctx.fillStyle = </span><span class="nx">color</span>
    <span class="vi">@plot_view.ctx.strokeStyle = </span><span class="nx">color</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">size</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>method : GlyphRendererView::calc_screen</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">calc_screen : </span><span class="nf">(glyph, direction, datapoint, mapper) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h4>Parameters</h4>

<ul>
<li>glyph : one glyph such as  @mget('glyphs')[0]</li>
<li>direction : 'x' or 'y'</li>
<li>datapoint : one record from the data source, as a dictionary</li>
<li>mapper : the mapper which pertains to dim</li>
</ul>

<h4>Returns</h4>

<ul>
<li>screen coordinate</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>get dim, first from the glyph, otherwise from the glyph
renderer model. dims can either be strings to specify the field name
<code>"x"</code>, or <code>"stockprice"</code>, or they can be an array
<code>["stockprice", 0.10, 0.20]</code>  If the dim is an array, the
first element is the field name, and the 2 floats are
data space offset and screen space offset for the glyph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dim = </span><span class="k">if</span> <span class="nx">glyph</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="k">then</span> <span class="nx">glyph</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="nx">direction</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">dim</span><span class="p">)</span>
      <span class="nv">data = </span><span class="nx">datapoint</span><span class="p">[</span><span class="nx">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
      <span class="nv">data = </span><span class="k">if</span> <span class="nx">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">then</span> <span class="nx">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">data</span> <span class="k">else</span> <span class="nx">data</span>
      <span class="nv">screenoffset = </span><span class="k">if</span> <span class="nx">dim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">then</span> <span class="nx">dim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">else</span>
      <span class="nv">data = </span><span class="nx">datapoint</span><span class="p">[</span><span class="nx">dim</span><span class="p">]</span>
      <span class="nv">screenoffset = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">dim</span> <span class="o">==</span> <span class="s">&#39;x&#39;</span>
      <span class="nv">screenoffset = </span><span class="nx">screenoffset</span> <span class="o">*</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">screenoffset = </span><span class="nx">screenoffset</span> <span class="o">*</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>
    <span class="nv">screen = </span><span class="nx">mapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">+</span> <span class="nx">screenoffset</span>
    <span class="k">return</span> <span class="nx">screen</span>

  <span class="nv">render_scatter : </span><span class="nf">(glyph, data) -&gt;</span>
    <span class="nv">datapoint = </span><span class="nx">data</span><span class="p">[</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
    <span class="nv">screenx = </span><span class="nx">@calc_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="nx">datapoint</span><span class="p">,</span> <span class="nx">@xmapper</span><span class="p">)</span>
    <span class="nv">screeny = </span><span class="nx">@calc_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="nx">datapoint</span><span class="p">,</span> <span class="nx">@ymapper</span><span class="p">)</span>
    <span class="nv">size = </span><span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">size</span> <span class="k">then</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">size</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;scatter_size&#39;</span><span class="p">)</span>
    <span class="nv">color = </span><span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">color</span> <span class="k">then</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">color</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;color&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;circle&#39;</span>
      <span class="nx">@addCircle</span><span class="p">(</span><span class="nx">screenx</span><span class="p">,</span> <span class="nx">screeny</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;square&#39;</span>
      <span class="nx">@addSquare</span><span class="p">(</span><span class="nx">screenx</span><span class="p">,</span> <span class="nx">screeny</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>

  <span class="nv">render : </span><span class="o">-&gt;</span>
    <span class="nv">screen_glpyhs = </span><span class="p">[]</span>
    <span class="nv">data = </span><span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">glyph</span> <span class="k">in</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;glyphs&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;circle&#39;</span> <span class="o">or</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;square&#39;</span>
        <span class="nx">@render_scatter</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;line&#39;</span>
        <span class="s">&#39;pass&#39;</span>

<span class="k">class</span> <span class="nx">ScatterRendererView</span> <span class="k">extends</span> <span class="nx">XYRendererView</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>FIXME: render_canvas</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render : </span><span class="o">-&gt;</span>
    <span class="s">&quot;use strict&quot;</span><span class="p">;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;selecting&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>skip data sources which are not selecting'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@render_end</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">null</span>

    <span class="nv">data = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
    <span class="nx">@calc_buffer</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="vi">@plot_view.ctx.fillStyle = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;foreground_color&#39;</span><span class="p">)</span>
    <span class="vi">@plot_view.ctx.strokeStyle = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;foreground_color&#39;</span><span class="p">)</span>
    <span class="nv">color_field = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;color_field&#39;</span><span class="p">)</span>
    <span class="nv">ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span>
    <span class="k">if</span> <span class="nx">color_field</span>
      <span class="nv">color_mapper = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;color_mapper&#39;</span><span class="p">)</span>
      <span class="nv">color_arr = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;color_field&#39;</span><span class="p">)</span>
    <span class="nv">mark_type = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;mark&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">@screeny</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">color_field</span>
        <span class="nv">comp_color = </span><span class="nx">color_mapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">idx</span><span class="p">)</span>
        <span class="vi">@plot_view.ctx.strokeStyle = </span><span class="nx">comp_color</span>
        <span class="vi">@plot_view.ctx.fillStyle = </span><span class="nx">comp_color</span>
      <span class="k">if</span> <span class="nx">mark_type</span> <span class="o">==</span> <span class="s">&quot;square&quot;</span>
        <span class="nx">@addPolygon</span><span class="p">(</span><span class="nx">@screenx</span><span class="p">[</span><span class="nx">idx</span><span class="p">],</span> <span class="nx">@screeny</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span>
      <span class="k">else</span>
        <span class="nx">@addCircle</span><span class="p">(</span><span class="nx">@screenx</span><span class="p">[</span><span class="nx">idx</span><span class="p">],</span> <span class="nx">@screeny</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">@render_end</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">null</span>

<span class="k">class</span> <span class="nx">ScatterSelectionOverlayView</span> <span class="k">extends</span> <span class="nx">PlotWidget</span>
  <span class="nv">bind_events : </span><span class="nf">() -&gt;</span>
    <span class="s">&#39;pass&#39;</span>
  <span class="nv">bind_bokeh_events  : </span><span class="nf">() -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>add logic so that if the number of renderers change, the new renderers are bound</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">renderer</span> <span class="k">in</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;renderers&#39;</span><span class="p">)</span>
      <span class="nx">safebind</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
      <span class="nx">safebind</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;xdata_range&#39;</span><span class="p">),</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
      <span class="nx">safebind</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;xdata_range&#39;</span><span class="p">),</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span>
      <span class="nx">safebind</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">),</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@request_render</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>FIXME integrate into ScatterRenderer</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render : </span><span class="nf">() -&gt;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">overlay_render</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">renderer</span> <span class="k">in</span> <span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;renderers&#39;</span><span class="p">)</span>
      <span class="nv">rendererview = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">renderers</span><span class="p">[</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
      <span class="nv">selected = </span><span class="p">{}</span>
      <span class="k">if</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;selecting&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>skip data sources which are not selecting'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">continue</span>
      <span class="nv">sel_idxs = </span><span class="nx">renderer</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;selected&#39;</span><span class="p">)</span>
      <span class="nv">ds = </span><span class="nx">renderer</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">)</span>
      <span class="nv">data = </span><span class="nx">ds</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>hugo - i think we need to do this each time....
or else panning does not work</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">rendererview</span><span class="p">.</span><span class="nx">calc_buffer</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
      <span class="nv">fcolor = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;foreground_color&#39;</span><span class="p">)</span>
      <span class="nv">rvm = </span><span class="nx">rendererview</span><span class="p">.</span><span class="nx">model</span>

      <span class="nv">fcolor = </span><span class="nx">rvm</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;foreground_color&#39;</span><span class="p">)</span>
      <span class="nv">unselected_color = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;unselected_color&#39;</span><span class="p">)</span>
      <span class="nv">color_field = </span><span class="nx">rvm</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;color_field&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">color_field</span>
        <span class="nv">color_mapper = </span><span class="nx">rvm</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="s">&#39;color_mapper&#39;</span><span class="p">)</span>
      <span class="nv">color_arr = </span><span class="nx">rvm</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;color_field&#39;</span><span class="p">)</span>
      <span class="nv">mark_type = </span><span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;mark&#39;</span><span class="p">)</span>
      <span class="nv">last_color_field = </span><span class="nx">fcolor</span>
      <span class="vi">@plot_view.ctx.strokeStyle = </span><span class="nx">fcolor</span>
      <span class="vi">@plot_view.ctx.fillStyle = </span><span class="nx">fcolor</span>

      <span class="nv">last_color_field = </span><span class="kc">false</span>
      <span class="nv">ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span>
      <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
        <span class="k">if</span> <span class="nx">idx</span> <span class="k">in</span> <span class="nx">sel_idxs</span>
          <span class="k">if</span> <span class="nx">color_field</span>
            <span class="nv">comp_color = </span><span class="nx">color_mapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">idx</span><span class="p">)</span>
            <span class="nv">ctx.strokeStyle = </span><span class="nx">comp_color</span>
            <span class="nv">ctx.fillStyle = </span><span class="nx">comp_color</span>
          <span class="k">else</span>
            <span class="nv">ctx.strokeStyle = </span><span class="nx">fcolor</span>
            <span class="nv">ctx.fillStyle = </span><span class="nx">fcolor</span>
        <span class="k">else</span>
          <span class="nv">ctx.fillStyle = </span><span class="nx">unselected_color</span>
          <span class="nv">ctx.strokeStyle = </span><span class="nx">unselected_color</span>
        <span class="k">if</span> <span class="nx">mark_type</span> <span class="o">==</span> <span class="s">&quot;square&quot;</span>
          <span class="nx">@addPolygon</span><span class="p">(</span><span class="nx">rendererview</span><span class="p">.</span><span class="nx">screenx</span><span class="p">[</span><span class="nx">idx</span><span class="p">],</span> <span class="nx">rendererview</span><span class="p">.</span><span class="nx">screeny</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span>
        <span class="k">else</span>
          <span class="nx">@addCircle</span><span class="p">(</span><span class="nx">rendererview</span><span class="p">.</span><span class="nx">screenx</span><span class="p">[</span><span class="nx">idx</span><span class="p">],</span> <span class="nx">rendererview</span><span class="p">.</span><span class="nx">screeny</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">@render_end</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">null</span>
<span class="nb">window</span><span class="p">.</span><span class="nv">overlay_render = </span><span class="mi">0</span>

<span class="nv">Bokeh.PlotWidget = </span><span class="nx">PlotWidget</span>
<span class="nv">Bokeh.PlotView = </span><span class="nx">PlotView</span>
<span class="nv">Bokeh.ScatterRendererView = </span><span class="nx">ScatterRendererView</span>
<span class="nv">Bokeh.LineRendererView = </span><span class="nx">LineRendererView</span>
<span class="nv">Bokeh.GlyphRendererView = </span><span class="nx">GlyphRendererView</span>
<span class="nv">Bokeh.GridPlotContainerView = </span><span class="nx">GridPlotContainerView</span>
<span class="nv">Bokeh.ScatterSelectionOverlayView = </span><span class="nx">ScatterSelectionOverlayView</span>
<span class="nv">Bokeh.LinearAxisView = </span><span class="nx">LinearAxisView</span>
<span class="nv">Bokeh.LinearDateAxisView = </span><span class="nx">LinearDateAxisView</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 