<!DOCTYPE html>  <html> <head>   <title>base.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.html">                 base.coffee               </a>                                           <a class="source" href="bokeh_model.html">                 bokeh_model.coffee               </a>                                           <a class="source" href="coffee_style_guide.html">                 coffee_style_guide.coffee               </a>                                           <a class="source" href="container.html">                 container.coffee               </a>                                           <a class="source" href="datasource.html">                 datasource.coffee               </a>                                           <a class="source" href="glyph_renderers.html">                 glyph_renderers.coffee               </a>                                           <a class="source" href="guides.html">                 guides.coffee               </a>                                           <a class="source" href="mapper.html">                 mapper.coffee               </a>                                           <a class="source" href="overlays.html">                 overlays.coffee               </a>                                           <a class="source" href="ranges.html">                 ranges.coffee               </a>                                           <a class="source" href="schema_renderers.html">                 schema_renderers.coffee               </a>                                           <a class="source" href="table.html">                 table.coffee               </a>                                           <a class="source" href="testutils.html">                 testutils.coffee               </a>                                           <a class="source" href="ticks.html">                 ticks.coffee               </a>                                           <a class="source" href="tools.html">                 tools.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               base.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Module setup stuff</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">Bokeh</span>
  <span class="nv">Bokeh = </span><span class="k">this</span><span class="p">.</span><span class="nx">Bokeh</span>
<span class="k">else</span>
  <span class="nv">Bokeh = </span><span class="p">{}</span>
  <span class="k">this</span><span class="p">.</span><span class="nv">Bokeh = </span><span class="nx">Bokeh</span>
<span class="k">if</span> <span class="k">this</span><span class="p">.</span><span class="nx">Continuum</span>
  <span class="nv">Continuum = </span><span class="k">this</span><span class="p">.</span><span class="nx">Continuum</span>
<span class="k">else</span>
  <span class="nv">Continuum = </span><span class="p">{}</span>
  <span class="k">this</span><span class="p">.</span><span class="nv">Continuum = </span><span class="nx">Continuum</span>
<span class="k">if</span> <span class="o">not</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">Collections</span>
  <span class="nv">Collections = </span><span class="p">{}</span>
  <span class="nv">Continuum.Collections = </span><span class="nx">Collections</span>
<span class="k">else</span>
  <span class="nv">Collections = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">Collections</span>
<span class="nv">Bokeh.Collections = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">Collections</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>function : safebind</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">safebind = </span><span class="nf">(binder, target, event, callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>safebind, binder binds to an event on target, which triggers callback.
Safe means that when the binder is destroyed, all callbacks are unbound.
callbacks are bound and evaluated in the context of binder.  Now that
backbone 0.99 is out, with listenTo and stopListening functions, which
manage event lifecycles, we probably don't need this function</p>

<h4>Parameters</h4>

<ul>
<li>binder : backbone model or view - when this is destroyed or removed,
the callback
unbound</li>
<li>target : object triggering the event we want to bind to</li>
<li>event : string, name of the event</li>
<li>callback : callback for the event</li>
</ul>

<h4>Returns</h4>

<ul>
<li>null</li>
</ul>

<p>stores objects we are binding events on, so that if we go away,
we can unbind all our events
currently, we require that the context being used is the binders context
this is because we currently unbind on a per context basis.  this can
be changed later if we need it</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">binder</span><span class="p">,</span> <span class="s">&#39;eventers&#39;</span><span class="p">)</span>
    <span class="nx">binder</span><span class="p">[</span><span class="s">&#39;eventers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">try</span>
    <span class="nx">binder</span><span class="p">[</span><span class="s">&#39;eventers&#39;</span><span class="p">][</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">target</span>
  <span class="k">catch</span> <span class="nx">error</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>also need to bind destroy to remove obj from eventers.
no special logic needed to manage this life cycle, because
we will already unbind all listeners on target when binder goes away</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">target</span><span class="o">?</span>
    <span class="nx">target</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">binder</span><span class="p">)</span>
    <span class="nx">target</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">&#39;destroy remove&#39;</span><span class="p">,</span>
      <span class="p">()</span> <span class="o">=&gt;</span>
        <span class="k">delete</span> <span class="nx">binder</span><span class="p">[</span><span class="s">&#39;eventers&#39;</span><span class="p">][</span><span class="nx">target</span><span class="p">]</span>
      <span class="p">,</span>
        <span class="nx">binder</span><span class="p">)</span>
   <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>debugger;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;error with binder&quot;</span><span class="p">,</span> <span class="nx">binder</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>we create a dictionary of collections, for all types that we know,
we use these when models are pushed down from the server</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">Collection</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>at some point, I thought we needed to override create...
we don't anymore...
can switch back to Backbone.Collection later</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>backbone note - we're sort of using defaults in the code to tell the user
what attributes are expected, so please specify defaults for
all attributes you plan on usign</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Reference System
we enable models to refer to other models using the following json</p>

<pre><code>collections : ['Continuum', 'Collections']
type : 'Plot'
id : '239009203923'
</code></pre>

<p>The collections and type field tell us that
window.Continuum.Collections.Plot is the collection which has the model id
'239009203923'.  Currently we only use the collections field when the
models are being broadcast from the server.  This is overly complex,
we should unify collections and type so that collections looks like</p>

<pre><code>collections : ['Continuum', 'Collections', 'Plot']
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>function : load models.</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Continuum.load_models = </span><span class="nf">(modelspecs)-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>First we identify which model jsons correspond to new models,
and which ones are updates.
For new models we instantiate the models, add them
to their collections and call dinitialize.
For existing models we update
their attributes</p>

<h4>Parameters</h4>

<ul>
<li><p>modelspecs : list of models in json form, looking like this</p>

<pre><code>type : 'Plot'
collections : ['Continuum', 'Collections']
id : '2390-23-23'
attributes :
  firstattr : 'one'
name : 'myplot'
renderers : []
</code></pre>

<p>collections tells us where to find the dictionary of collections used to
construct the model
type is the key of the in collections for this model
id is the id of this model
attributes are the attributes of the model</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h4>Returns</h4>

<ul>
<li>null</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">newspecs = </span><span class="p">[]</span>
  <span class="nv">oldspecs = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>split out old and new models into arrays of
<code>[[collection, attributes], [collection, attributes]]</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">model</span> <span class="k">in</span> <span class="nx">modelspecs</span>
    <span class="nv">coll = </span><span class="nx">get_collections</span><span class="p">(</span><span class="nx">model</span><span class="p">[</span><span class="s">&#39;collections&#39;</span><span class="p">])[</span><span class="nx">model</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]]</span>
    <span class="nv">attrs = </span><span class="nx">model</span><span class="p">[</span><span class="s">&#39;attributes&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">coll</span> <span class="o">and</span>  <span class="nx">coll</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
      <span class="nx">oldspecs</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">])</span>
    <span class="k">else</span>
      <span class="nx">newspecs</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>add new objects to collections silently</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">coll_attrs</span> <span class="k">in</span> <span class="nx">newspecs</span>
    <span class="p">[</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">coll_attrs</span>
    <span class="k">if</span> <span class="nx">coll</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;silent&#39;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>call deferred initialize on all new models</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">coll_attrs</span> <span class="k">in</span> <span class="nx">newspecs</span>
    <span class="p">[</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">coll_attrs</span>
    <span class="k">if</span> <span class="nx">coll</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]).</span><span class="nx">dinitialize</span><span class="p">(</span><span class="nx">attrs</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>set attributes on old models silently</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">coll_attrs</span> <span class="k">in</span> <span class="nx">oldspecs</span>
    <span class="p">[</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">coll_attrs</span>
    <span class="k">if</span> <span class="nx">coll</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]).</span><span class="nx">set</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;local&#39;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s">&#39;silent&#39;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>trigger add events on all new models</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">coll_attrs</span> <span class="k">in</span> <span class="nx">newspecs</span>
    <span class="p">[</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">coll_attrs</span>
    <span class="k">if</span> <span class="nx">coll</span>
      <span class="nv">model = </span><span class="nx">coll</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
      <span class="nx">model</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">coll</span><span class="p">,</span> <span class="p">{});</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>trigger change events on all old models</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">coll_attrs</span> <span class="k">in</span> <span class="nx">oldspecs</span>
    <span class="p">[</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">coll_attrs</span>
    <span class="k">if</span> <span class="nx">coll</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]).</span><span class="nx">change</span><span class="p">()</span>

  <span class="k">return</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h3>class : Continuum.WebsocketWrapper</h3>

<p>wraps websockets, provides a @connected promise, which
you can wait on before sending subscription messages
also triggers "msg:topic" events, with an arg of the msg
data.  We assume that msg data over this websocket
channel are sent in "topic:data" form, where data can
be any arbitrary string. note that since topic is prefixed with :,
in practice a message looks like bokehplot:docid:jsondata</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">WebSocketWrapper</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">@prototype</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>method :</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor : </span><span class="nf">(ws_conn_string) -&gt;</span>
    <span class="vi">@ws_conn_string = </span><span class="nx">ws_conn_string</span>
    <span class="vi">@_connected = </span><span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">()</span>
    <span class="vi">@connected = </span><span class="nx">@_connected</span><span class="p">.</span><span class="nx">promise</span><span class="p">()</span>
    <span class="k">try</span>
      <span class="vi">@s = </span><span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">ws_conn_string</span><span class="p">)</span>
    <span class="k">catch</span> <span class="nx">error</span>
      <span class="vi">@s = </span><span class="k">new</span> <span class="nx">MozWebSocket</span><span class="p">(</span><span class="nx">ws_conn_string</span><span class="p">)</span>
    <span class="vi">@s.onopen = </span><span class="p">()</span> <span class="o">=&gt;</span>
      <span class="nx">@_connected</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span>
    <span class="vi">@s.onmessage = </span><span class="nx">@onmessage</span>
    <span class="k">return</span> <span class="nx">@</span>

  <span class="nv">onmessage : </span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nv">data = </span><span class="nx">msg</span><span class="p">.</span><span class="nx">data</span>
    <span class="nv">index = </span><span class="nx">data</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="c1">#first colon marks topic namespace</span>
    <span class="nv">index = </span><span class="nx">data</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">#second colon marks the topic</span>
    <span class="nv">topic = </span><span class="nx">data</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span>
    <span class="nv">data = </span><span class="nx">data</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s">&quot;msg:&quot;</span> <span class="o">+</span> <span class="nx">topic</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>function : Continuum.submodels</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Continuum.submodels = </span><span class="nf">(wswrapper, topic, apikey) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>creates a websocket which subscribes and listens for model changes</p>

<h5>Parameters</h5>

<ul>
<li>ws<em>conn</em>string : path of the web socket to subscribe</li>
<li>topic : topic to listen on (send to the server on connect)</li>
</ul>

<h5>Returns</h5>

<ul>
<li>the websocket</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="k">when</span><span class="p">(</span><span class="nx">wswrapper</span><span class="p">.</span><span class="nx">connected</span><span class="p">).</span><span class="k">then</span><span class="p">(</span><span class="nf">() -&gt;</span>
    <span class="nv">msg = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span>
      <span class="p">{</span><span class="nv">msgtype : </span><span class="s">&#39;subscribe&#39;</span><span class="p">,</span> <span class="nv">topic : </span><span class="nx">topic</span><span class="p">,</span> <span class="nv">auth : </span><span class="nx">apikey</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="nx">wswrapper</span><span class="p">.</span><span class="nx">s</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="nx">wswrapper</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s">&quot;msg:&quot;</span> <span class="o">+</span> <span class="nx">topic</span><span class="p">,</span> <span class="nf">(msg) -&gt;</span>
    <span class="nv">msgobj = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">msgobj</span><span class="p">[</span><span class="s">&#39;msgtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;modelpush&#39;</span>
      <span class="nx">Continuum</span><span class="p">.</span><span class="nx">load_models</span><span class="p">(</span><span class="nx">msgobj</span><span class="p">[</span><span class="s">&#39;modelspecs&#39;</span><span class="p">])</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">msgobj</span><span class="p">[</span><span class="s">&#39;msgtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;modeldel&#39;</span>
      <span class="k">for</span> <span class="nx">ref</span> <span class="k">in</span> <span class="nx">msgobj</span><span class="p">[</span><span class="s">&#39;modelspecs&#39;</span><span class="p">]</span>
        <span class="nv">model = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">resolve_ref</span><span class="p">(</span>
          <span class="nx">ref</span><span class="p">[</span><span class="s">&#39;collections&#39;</span><span class="p">],</span> <span class="nx">ref</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span> <span class="nx">ref</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nx">model</span>
          <span class="nx">model</span><span class="p">.</span><span class="nx">destroy</span><span class="p">({</span><span class="s">&#39;local&#39;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">})</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">msgobj</span><span class="p">[</span><span class="s">&#39;msgtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;status&#39;</span> <span class="o">and</span>
      <span class="nx">msgobj</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;subscribesuccess&#39;</span>
        <span class="nv">clientid = </span><span class="nx">msgobj</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="nv">Continuum.clientid = </span><span class="nx">clientid</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span><span class="s">&#39;headers&#39;</span> <span class="o">:</span> <span class="p">{</span><span class="s">&#39;Continuum-Clientid&#39;</span> <span class="o">:</span> <span class="nx">clientid</span><span class="p">}})</span>
    <span class="k">else</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msgobj</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span>
  <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h3>function : resolve_ref</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">resolve_ref = </span><span class="nf">(collections, type, id) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Takes a group of collections, type and id, and returns the backbone model
which corresponds</p>

<h4>Parameters</h4>

<ul>
<li>collections : group of collections (as a dict),
the collection for type should be present here.
Alternatively, one can specify this as an array of strings,
in which case we descend through the global namespace
looking for this, using  get_collections.</li>
<li>type : type of the object</li>
<li>id : id of the object</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h4>Returns</h4>

<ul>
<li>backbone model</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">collections</span><span class="p">)</span>
    <span class="nv">collections = </span><span class="nx">get_collections</span><span class="p">(</span><span class="nx">collections</span><span class="p">)</span>
  <span class="k">try</span>
    <span class="nv">model = </span><span class="nx">collections</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
  <span class="k">catch</span> <span class="nx">error</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>return collections[type].get(id)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span>  <span class="nx">model</span>

<span class="nv">Continuum.resolve_ref = </span><span class="nx">resolve_ref</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h3>function : get_collections</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">get_collections = </span><span class="nf">(names) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>finds a group of collections, at the location specified by names</p>

<h4>Parameters</h4>

<ul>
<li>names : list of strings - we start at the global name spaces and descend
through each string.  the last value should refer to the group of
collections you want</li>
</ul>

<h4>Returns</h4>

<ul>
<li>collections</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">last = </span><span class="nb">window</span>
  <span class="k">for</span> <span class="nx">n</span> <span class="k">in</span> <span class="nx">names</span>
    <span class="nv">last = </span><span class="nx">last</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">last</span>

<span class="nv">Continuum.get_collections = </span><span class="nx">get_collections</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h3>class : HasProperties</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">HasProperties</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Our property system
we support python style computed properties, with getters
as well as setters. We also support caching of these properties,
and notifications of property. We also support weak references
to other models using the reference system described above.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">collections : </span><span class="nx">Collections</span>
  <span class="nv">destroy : </span><span class="nf">(options)-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>calls super, also unbinds any events bound by safebind</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">super</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s">&#39;eventers&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">@eventers</span>
        <span class="nx">val</span><span class="p">.</span><span class="kc">off</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>

  <span class="nv">isNew : </span><span class="nf">() -&gt;</span>
    <span class="k">return</span> <span class="o">not</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;created&#39;</span><span class="p">)</span>

  <span class="nv">initialize : </span><span class="nf">(attrs, options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>auto generates ids if we need to, calls deferred initialize if we have
not done so already.   sets up datastructures for computed properties</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">attrs</span>
       <span class="nv">attrs = </span><span class="p">{}</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">options</span>
      <span class="nv">options = </span><span class="p">{}</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="vi">@properties = </span><span class="p">{}</span>
    <span class="vi">@property_cache = </span><span class="p">{}</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nv">id = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span><span class="p">(()</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">@inited</span>
        <span class="nx">@dinitialize</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="nx">options</span><span class="p">))</span>

  <span class="nv">dinitialize : </span><span class="nf">(attrs, options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>deferred initialization - this is important so we can separate object
creation from object initialization.  We need this if we receive a group
of objects, that need to bind events to each other.  Then we create them all
first, and then call deferred intialization so they can setup dependencies
on each other</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@inited = </span><span class="kc">true</span>

  <span class="nv">set_obj : </span><span class="nf">(key, value, options) -&gt;</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">or</span> <span class="nx">key</span> <span class="o">==</span> <span class="kc">null</span>
      <span class="nv">attrs = </span><span class="nx">key</span>
      <span class="nv">options = </span><span class="nx">value</span>
    <span class="k">else</span>
      <span class="nv">attrs = </span><span class="p">{}</span>
      <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">attrs</span>
      <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@convert_to_ref</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">@set</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

  <span class="nv">set : </span><span class="nf">(key, value, options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>checks for setters, if setters are present, call setters first
then remove the computed property from the dict of attrs, and call super</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>backbones set function supports 2 call signatures, either a dictionary of
key value pairs, and then options, or one key, one value, and then options.
replicating that logic here</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">or</span> <span class="nx">key</span> <span class="o">==</span> <span class="kc">null</span>
      <span class="nv">attrs = </span><span class="nx">key</span>
      <span class="nv">options = </span><span class="nx">value</span>
    <span class="k">else</span>
      <span class="nv">attrs = </span><span class="p">{}</span>
      <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="nv">toremove  = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">attrs</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s">&#39;properties&#39;</span><span class="p">)</span> <span class="o">and</span>
         <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">@properties</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">and</span>
         <span class="nx">@properties</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="s">&#39;setter&#39;</span><span class="p">]</span>
        <span class="nx">@properties</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="s">&#39;setter&#39;</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
        <span class="nx">toremove</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">toremove</span>
      <span class="k">delete</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">attrs</span><span class="p">)</span>
      <span class="k">super</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

  <span class="nv">convert_to_ref : </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>converts value into a refrence if necessary
works vectorized</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">@convert_to_ref</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">HasProperties</span>
        <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">ref</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <h3>method : HasProperties::add_dependencies</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add_dependencies: </span> <span class="nf">(prop_name, object, fields) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <ul>
<li>prop_name - name of property</li>
<li>object - object on which dependencies reside</li>
<li>fields - attributes on that object
at some future date, we should support a third arg, events</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">fields</span><span class="p">)</span>
      <span class="nv">fields = </span><span class="p">[</span><span class="nx">fields</span><span class="p">]</span>
    <span class="nv">prop_spec = </span><span class="nx">@properties</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span>
    <span class="nv">prop_spec.dependencies = </span><span class="nx">prop_spec</span><span class="p">.</span><span class="nx">dependencies</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span>
      <span class="nv">obj : </span><span class="nx">object</span>
      <span class="nv">fields : </span><span class="nx">fields</span>
    <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>bind depdencies to change dep callback</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">fld</span> <span class="k">in</span> <span class="nx">fields</span>
      <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">object</span><span class="p">,</span> <span class="s">&quot;change:&quot;</span> <span class="o">+</span> <span class="nx">fld</span><span class="p">,</span>
          <span class="nx">prop_spec</span><span class="p">[</span><span class="s">&#39;callbacks&#39;</span><span class="p">][</span><span class="s">&#39;changedep&#39;</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <h3>method : HasProperties::register_setter</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">register_setter : </span><span class="nf">(prop_name, setter) -&gt;</span>
    <span class="nv">prop_spec = </span><span class="nx">@properties</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span>
    <span class="nv">prop_spec.setter = </span><span class="nx">setter</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <h3>method : HasProperties::register_property</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">register_property : </span> <span class="nf">(prop_name, getter, use_cache) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>register a computed property. Setters, and dependencies
can be added with <code>@add_dependencies</code> and <code>@register_setter</code></p>

<h4>Parameters</h4>

<ul>
<li>prop_name : name of property</li>
<li>getter : function, calculates computed value, takes no arguments</li>
<li>use_cache : whether to cache or not</li>
</ul>

<h4>Returns</h4>

<ul>
<li>prop_spec : specification of the property, with the getter,
setter, dependenices, and callbacks associated with the prop</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">use_cache</span><span class="p">)</span>
        <span class="nv">use_cache = </span><span class="kc">true</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">@properties</span><span class="p">,</span> <span class="nx">prop_name</span><span class="p">)</span>
        <span class="nx">@remove_property</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>we store a prop_spec, which has the getter, setter, dependencies
we also store the callbacks used to implement the computed property,
we do this so we can remove them later if the property is removed</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">changedep = </span><span class="p">()</span> <span class="o">=&gt;</span>
        <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;changedep:&#39;</span> <span class="o">+</span> <span class="nx">prop_name</span><span class="p">)</span>
      <span class="nv">propchange = </span><span class="p">()</span> <span class="o">=&gt;</span>
        <span class="nv">firechange = </span><span class="kc">true</span>
        <span class="k">if</span> <span class="nx">prop_spec</span><span class="p">[</span><span class="s">&#39;use_cache&#39;</span><span class="p">]</span>
          <span class="nv">old_val = </span><span class="nx">@get_cache</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">)</span>
          <span class="nx">@clear_cache</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">)</span>
          <span class="nv">new_val = </span><span class="nx">@get</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">)</span>
          <span class="nv">firechange = </span><span class="nx">new_val</span> <span class="o">!=</span> <span class="nx">old_val</span>
        <span class="k">if</span> <span class="nx">firechange</span>
          <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;change:&#39;</span> <span class="o">+</span> <span class="nx">prop_name</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">@get</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">))</span>
          <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
      <span class="nv">prop_spec=</span>
        <span class="s">&#39;getter&#39;</span> <span class="o">:</span> <span class="nx">getter</span><span class="p">,</span>
        <span class="s">&#39;dependencies&#39;</span> <span class="o">:</span> <span class="p">[],</span>
        <span class="s">&#39;use_cache&#39;</span> <span class="o">:</span> <span class="nx">use_cache</span>
        <span class="s">&#39;setter&#39;</span> <span class="o">:</span> <span class="kc">null</span>
        <span class="s">&#39;callbacks&#39;</span><span class="o">:</span>
          <span class="nv">changedep : </span><span class="nx">changedep</span>
          <span class="nv">propchange : </span><span class="nx">propchange</span>
      <span class="nx">@properties</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">prop_spec</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>bind propchange callback to change dep event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="s">&quot;changedep:&quot;</span> <span class="o">+</span> <span class="nx">prop_name</span><span class="p">,</span>
        <span class="nx">prop_spec</span><span class="p">[</span><span class="s">&#39;callbacks&#39;</span><span class="p">][</span><span class="s">&#39;propchange&#39;</span><span class="p">])</span>
      <span class="k">return</span> <span class="nx">prop_spec</span>

  <span class="nv">remove_property : </span><span class="nf">(prop_name) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>removes the property,
unbinding all associated callbacks that implemented it</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">prop_spec = </span><span class="nx">@properties</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span>
    <span class="nv">dependencies = </span><span class="nx">prop_spec</span><span class="p">.</span><span class="nx">dependencies</span>
    <span class="k">for</span> <span class="nx">dep</span> <span class="k">in</span> <span class="nx">dependencies</span>
      <span class="nv">obj = </span><span class="nx">dep</span><span class="p">.</span><span class="nx">obj</span>
      <span class="k">for</span> <span class="nx">fld</span> <span class="k">in</span> <span class="nx">dep</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">]</span>
        <span class="nx">obj</span><span class="p">.</span><span class="kc">off</span><span class="p">(</span><span class="s">&#39;change:&#39;</span> <span class="o">+</span> <span class="nx">fld</span><span class="p">,</span> <span class="nx">prop_spec</span><span class="p">[</span><span class="s">&#39;callbacks&#39;</span><span class="p">][</span><span class="s">&#39;changedep&#39;</span><span class="p">],</span> <span class="k">this</span><span class="p">)</span>
    <span class="nx">@</span><span class="kc">off</span><span class="p">(</span><span class="s">&quot;changedep:&quot;</span> <span class="o">+</span> <span class="nx">dep</span><span class="p">)</span>
    <span class="k">delete</span> <span class="nx">@properties</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">prop_spec</span><span class="p">.</span><span class="nx">use_cache</span>
      <span class="nx">@clear_cache</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">)</span>

  <span class="nv">has_cache : </span><span class="nf">(prop_name) -&gt;</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">@property_cache</span><span class="p">,</span> <span class="nx">prop_name</span><span class="p">)</span>

  <span class="nv">add_cache : </span><span class="nf">(prop_name, val) -&gt;</span>
    <span class="nx">@property_cache</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>

  <span class="nv">clear_cache : </span><span class="nf">(prop_name, val) -&gt;</span>
    <span class="k">delete</span> <span class="nx">@property_cache</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span>

  <span class="nv">get_cache : </span><span class="nf">(prop_name) -&gt;</span>
    <span class="k">return</span> <span class="nx">@property_cache</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span>

  <span class="nv">get : </span><span class="nf">(prop_name) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <h3>method : HasProperties::get</h3>

<p>overrides backbone get.  checks properties,
calls getter, or goes to cache
if necessary.  If it's not a property, then just call super</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">@properties</span><span class="p">,</span> <span class="nx">prop_name</span><span class="p">)</span>
      <span class="nv">prop_spec = </span><span class="nx">@properties</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">prop_spec</span><span class="p">.</span><span class="nx">use_cache</span> <span class="o">and</span> <span class="nx">@has_cache</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">@property_cache</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">]</span>
      <span class="k">else</span>
        <span class="nv">getter = </span><span class="nx">prop_spec</span><span class="p">.</span><span class="nx">getter</span>
        <span class="nv">computed = </span><span class="nx">getter</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">@properties</span><span class="p">[</span><span class="nx">prop_name</span><span class="p">].</span><span class="nx">use_cache</span>
          <span class="nx">@add_cache</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">,</span> <span class="nx">computed</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">computed</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="k">super</span><span class="p">(</span><span class="nx">prop_name</span><span class="p">)</span>

  <span class="nv">ref : </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <h3>method : HasProperties::ref</h3>

<p>generates a reference to this model</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&#39;type&#39;</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span>
    <span class="s">&#39;id&#39;</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span>

  <span class="nv">resolve_ref : </span><span class="p">(</span><span class="nx">ref</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <h3>method : HasProperties::resolve_ref</h3>

<p>converts a reference into an object
also works vectorized now</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">ref</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">ref</span><span class="p">,</span> <span class="nx">@resolve_ref</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">ref</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;ERROR, null reference&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>this way we can reference ourselves
even though we are not in any collection yet</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">ref</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">and</span> <span class="nx">ref</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span>
      <span class="k">return</span> <span class="k">this</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="nx">resolve_ref</span><span class="p">(</span><span class="nx">@collections</span><span class="p">,</span> <span class="nx">ref</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span> <span class="nx">ref</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>

  <span class="nv">get_obj : </span><span class="p">(</span><span class="nx">ref_name</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <h3>method : HasProperties::get_obj</h3>

<p>convenience function, gets the backbone attribute ref_name, which is assumed
to be a reference, then resolves the reference and returns the model</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ref = </span><span class="nx">@get</span><span class="p">(</span><span class="nx">ref_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">ref</span>
      <span class="k">return</span> <span class="nx">@resolve_ref</span><span class="p">(</span><span class="nx">ref</span><span class="p">)</span>

  <span class="nv">url : </span><span class="nf">() -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <h3>method HasProperties::url</h3>

<p>model where our API processes this model</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">base = </span><span class="s">&quot;/bokeh/bb/&quot;</span> <span class="o">+</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">docid</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">@type</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">@isNew</span><span class="p">())</span>
      <span class="k">return</span> <span class="nx">base</span>
    <span class="k">return</span> <span class="nx">base</span> <span class="o">+</span> <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>


  <span class="nv">sync : </span><span class="nf">(method, model, options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>this should be fixed via monkey patching when extended by an
environment that implements the model backend,
to enable normal beaviour, add this line</p>

<p>HasProperties.prototype.sync = Backbone.sync</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>

  <span class="nv">defaults : </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>hasparent
display<em>options can be passed down to children
defaults for display</em>options should be placed
in a class var display_defaults
the get function, will resolve an instances defaults first
then check the parents actual val, and finally check class defaults.
display options cannot go into defaults</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>defaults vs display_defaults
backbone already has a system for attribute defaults, however we wanted to
impose a secondary inheritance system for attributes based on GUI hierarchies
the idea being that you generally want to inherit UI attributes from
your container/parent.  Here is how we do this.
HasParent models can have a parent attribute, which is our
continuum reference.  when we try to get an attribute, first we try to
get the attribute via super (so try properties, and if not that, normal
backbone resolution) if that results in something which is undefined,
then try to grab the attribute from the parent.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>the reason why we need to segregate display_defaults into a separate object
form backbones normal default is because backbone defaults are automatically
set on the object, so you have no way of knowing whether the attr exists
because it was a default, or whether it was intentionally set.  In the
parent case, we want to try parent settings BEFORE we rely on
display defaults.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>functionally, since this is mostly there to facilitate deferred lookups,
perhaps a name besides display_defaults would be appropriate, we might want
to store non-display related defaults here.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">HasParent</span> <span class="k">extends</span> <span class="nx">HasProperties</span>
  <span class="nv">get_fallback : </span><span class="nf">(attr) -&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">@get_obj</span><span class="p">(</span><span class="s">&#39;parent&#39;</span><span class="p">)</span> <span class="o">and</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">@get_obj</span><span class="p">(</span><span class="s">&#39;parent&#39;</span><span class="p">).</span><span class="nx">parent_properties</span><span class="p">,</span> <span class="nx">attr</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">and</span>
        <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">@get_obj</span><span class="p">(</span><span class="s">&#39;parent&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="nx">attr</span><span class="p">)))</span>
      <span class="k">return</span> <span class="nx">@get_obj</span><span class="p">(</span><span class="s">&#39;parent&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">retval = </span><span class="nx">@display_defaults</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>this is ugly, we should take this out and not support object specs
in defaults</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">retval</span><span class="p">)</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">retval</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)</span>
        <span class="nv">attrs = </span><span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">retval</span><span class="p">,</span> <span class="s">&#39;attrs&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="nx">retval</span><span class="p">[</span><span class="s">&#39;attrs&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="nv">retval = </span> <span class="nx">@collections</span><span class="p">[</span><span class="nx">retval</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]].</span><span class="nx">create</span><span class="p">(</span><span class="nx">attrs</span><span class="p">).</span><span class="nx">ref</span><span class="p">()</span>
        <span class="nx">@set</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">retval</span><span class="p">)</span>
        <span class="nx">@save</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">retval</span>

  <span class="nv">get : </span><span class="nf">(attr) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <h1>no fallback for 'parent'</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">normalval = </span><span class="k">super</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">normalval</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">normalval</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">attr</span> <span class="o">==</span> <span class="s">&#39;parent&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">@get_fallback</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span>

  <span class="nv">display_defaults : </span><span class="p">{}</span>


<span class="nv">build_views = </span><span class="nf">(view_storage, view_models, options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <h2>function : build_views</h2>

<p>convenience function for creating a bunch of views from a spec
and storing them in a dictionary keyed off of model id.
views are automatically passed the model that they represent</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <h4>Parameters</h4>

<ul>
<li>mainmodel : model which is constructing the views, this is used to resolve
specs into other model objects</li>
<li>view_storage : where you want the new views stored.  this is a dictionary
views will be keyed by the id of the underlying model</li>
<li>view_specs : list of view specs.  view specs are continuum references, with
a typename and an id.  you can also pass options you want to feed into
the views constructor here, as an 'options' field in the dict</li>
<li>options : any additional option to be used in the construction of views</li>
<li>view_option : array, optional view specific options passed in to the construction of the view</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s">&quot;use strict&quot;</span><span class="p">;</span>
  <span class="nv">created_views = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>debugger</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">try</span>
    <span class="nv">newmodels = </span><span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">view_models</span><span class="p">,</span> <span class="nf">(x) -&gt;</span> <span class="k">return</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">view_storage</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
  <span class="k">catch</span> <span class="nx">error</span>
    <span class="nx">debugger</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
    <span class="k">throw</span> <span class="nx">error</span>
  <span class="k">for</span> <span class="nx">model</span> <span class="k">in</span> <span class="nx">newmodels</span>
    <span class="nv">view_specific_option = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">options</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;model&#39;</span> <span class="o">:</span> <span class="nx">model</span><span class="p">})</span>
    <span class="k">try</span>
      <span class="nx">view_storage</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">model</span><span class="p">.</span><span class="nx">default_view</span><span class="p">(</span><span class="nx">view_specific_option</span><span class="p">)</span>
    <span class="k">catch</span> <span class="nx">error</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;error on model of&quot;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
      <span class="k">throw</span> <span class="nx">error</span>
    <span class="nx">created_views</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">view_storage</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span>
  <span class="nv">to_remove = </span><span class="nx">_</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">view_storage</span><span class="p">),</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">view_models</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">))</span>
  <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">to_remove</span>
    <span class="nx">view_storage</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">remove</span><span class="p">()</span>
    <span class="k">delete</span> <span class="nx">view_storage</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">created_views</span>



<span class="k">class</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">ContinuumView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span>
  <span class="nv">initialize : </span><span class="nf">(options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>autogenerates id</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nv">id = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s">&#39;ContinuumView&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>bind<em>bokeh</em>events is always called after initialize has run</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bind_bokeh_events : </span><span class="nf">() -&gt;</span>
    <span class="s">&#39;pass&#39;</span>



  <span class="nv">delegateEvents : </span><span class="nf">(events) -&gt;</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">events</span><span class="p">)</span>
    <span class="nx">@bind_bokeh_events</span><span class="p">()</span>

  <span class="nv">remove : </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>handles lifecycle of events bound by safebind</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s">&#39;eventers&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">@eventers</span>
        <span class="nx">val</span><span class="p">.</span><span class="kc">off</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s">&#39;remove&#39;</span><span class="p">)</span>
    <span class="k">super</span><span class="p">()</span>

  <span class="nv">mget : </span><span class="nf">()-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>convenience function, calls get on the associated model</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">@model</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>

  <span class="nv">mset : </span><span class="nf">()-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>convenience function, calls set on the associated model</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">@model</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>

  <span class="nv">mget_obj : </span><span class="nf">(fld) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>convenience function, calls get_obj on the associated model</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">get_obj</span><span class="p">(</span><span class="nx">fld</span><span class="p">)</span>
  <span class="nv">render_end : </span><span class="nf">() -&gt;</span>
    <span class="s">&quot;pass&quot;</span>


<span class="k">class</span> <span class="nx">PlotWidget</span> <span class="k">extends</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">ContinuumView</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Everything that lives inside a plot container should
inherit from this class.  All plot widgets are
passed in the plot model and view
This class also contains some basic canvas rendering primitives
we also include the request_render function, which
calls a throttled version of the plot canvas rendering function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tagName : </span><span class="s">&#39;div&#39;</span>
  <span class="nv">marksize : </span><span class="mi">3</span>
  <span class="nv">initialize : </span><span class="nf">(options) -&gt;</span>
    <span class="vi">@plot_model = </span><span class="nx">options</span><span class="p">.</span><span class="nx">plot_model</span>
    <span class="vi">@plot_view = </span><span class="nx">options</span><span class="p">.</span><span class="nx">plot_view</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

  <span class="nv">bind_bokeh_events : </span><span class="o">-&gt;</span>
    <span class="nx">safebind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nf">()-&gt;</span>
        <span class="nx">@request_render</span><span class="p">())</span>

  <span class="nv">addPolygon: </span><span class="nf">(x,y) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">@marksize</span><span class="p">,</span><span class="nx">@marksize</span><span class="p">)</span>

  <span class="nv">addCircle: </span><span class="nf">(x,y) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">@marksize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

  <span class="nv">request_render : </span><span class="nf">() -&gt;</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">throttled</span><span class="p">()</span>

<span class="nv">Bokeh.PlotWidget = </span><span class="nx">PlotWidget</span>
<span class="nv">Continuum.safebind = </span><span class="nx">safebind</span>
<span class="nv">Continuum.HasProperties = </span><span class="nx">HasProperties</span>
<span class="nv">Continuum.build_views = </span><span class="nx">build_views</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 