<!DOCTYPE html>  <html> <head>   <title>glyph_renderers.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.html">                 base.coffee               </a>                                           <a class="source" href="bokeh_model.html">                 bokeh_model.coffee               </a>                                           <a class="source" href="coffee_style_guide.html">                 coffee_style_guide.coffee               </a>                                           <a class="source" href="container.html">                 container.coffee               </a>                                           <a class="source" href="datasource.html">                 datasource.coffee               </a>                                           <a class="source" href="glyph_renderers.html">                 glyph_renderers.coffee               </a>                                           <a class="source" href="guides.html">                 guides.coffee               </a>                                           <a class="source" href="mapper.html">                 mapper.coffee               </a>                                           <a class="source" href="overlays.html">                 overlays.coffee               </a>                                           <a class="source" href="ranges.html">                 ranges.coffee               </a>                                           <a class="source" href="schema_renderers.html">                 schema_renderers.coffee               </a>                                           <a class="source" href="table.html">                 table.coffee               </a>                                           <a class="source" href="testutils.html">                 testutils.coffee               </a>                                           <a class="source" href="ticks.html">                 ticks.coffee               </a>                                           <a class="source" href="tools.html">                 tools.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               glyph_renderers.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Setup Bokeh Module</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Collections = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">Collections</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>MAIN BOKEH CLASSES</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>backbone assumes that valid attrs are any non-null, or non-defined value
thats dumb, we only check for undefined, because null is perfectly valid</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">safebind = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">safebind</span>
<span class="nv">HasParent = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">HasParent</span>
<span class="nv">BokehView = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">ContinuumView</span>
<span class="nv">HasProperties = </span><span class="nx">Continuum</span><span class="p">.</span><span class="nx">HasProperties</span>


<span class="k">class</span> <span class="nx">MetaGlyph</span>
  <span class="nv">constructor: </span><span class="nf">(@styleprovider, @glyphspec, @attrnames) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <ul>
<li>attrnames: a list of attribute names. They can have an optional type
suffix, separated by a colon, where the type string can be
<code>'number'</code>, <code>'string'</code>, or <code>'array'</code>. The default is <code>'number'</code>.
These types determine how to interpret values in the glyphspec.
For <code>number</code> and <code>array</code> fields, if a string is provided, then it is
treated as a field name specifier. For <code>string</code> fields, a string is
treated as a default value. For <code>array</code> fields, any non-array literal
value is wrapped into a single-element array.</li>
<li>glyphspec: the glyph specification object, usually defined in the
<code>glyphs</code> field of a GlyphRenderer</li>
<li>styleprovider: something with an <code>.mget()</code> method that can produce
a concrete value (or fieldname) for each of the attributes</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">make_glyph: </span><span class="nf">(datapoint) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Returns an object that has properties corresponding all of the named
attributes in <code>attrnames</code>, as well as $NAME_units. (The latter is a
string, usually <code>'data'</code> or <code>'screen'</code>, but in some cases can be actual
mathematical units like deg/rad.)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">glyph = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">attrname</span> <span class="k">in</span> <span class="nx">@attrnames</span>
      <span class="k">if</span> <span class="nx">attrname</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">[</span><span class="nx">attrname</span><span class="p">,</span> <span class="nx">attrtype</span><span class="p">]</span> <span class="o">=</span> <span class="nx">attrname</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nv">attrtype = </span><span class="s">&quot;number&quot;</span>
      <span class="nv">unitsname = </span><span class="nx">attrname</span> <span class="o">+</span> <span class="s">&quot;_units&quot;</span>

      <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">attrname</span> <span class="k">of</span> <span class="nx">@glyphspec</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The field is absent from the glyph specification.
Use the default field name and check for its existence on the
datapoint. If it doesn't exist, then read the defaults from the
styleprovider. The default value of <code>units</code> is always <code>'data'</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">attrname</span> <span class="k">of</span> <span class="nx">datapoint</span>
          <span class="nx">glyph</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">datapoint</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span>
        <span class="k">else</span>
          <span class="nx">glyph</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@styleprovider</span><span class="p">.</span><span class="nx">mget</span><span class="p">(</span><span class="nx">attrname</span><span class="p">)</span>

        <span class="nv">units = </span><span class="nx">@styleprovider</span><span class="p">.</span><span class="nx">mget</span><span class="p">(</span><span class="nx">unitsname</span><span class="p">)</span>
        <span class="nx">glyph</span><span class="p">[</span><span class="nx">unitsname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">units</span> <span class="o">?</span> <span class="s">&#39;data&#39;</span>
        <span class="k">continue</span>

      <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">@glyphspec</span><span class="p">[</span><span class="nx">attrname</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The glyph specification provided a number. This is always a
default value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">glyph</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">attrname</span> <span class="k">of</span> <span class="nx">datapoint</span> <span class="k">then</span> <span class="nx">datapoint</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span> <span class="k">else</span> <span class="nx">@glyphspec</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span>
        <span class="nv">units = </span><span class="nx">@styleprovider</span><span class="p">.</span><span class="nx">mget</span><span class="p">(</span><span class="nx">unitsname</span><span class="p">)</span>
        <span class="nx">glyph</span><span class="p">[</span><span class="nx">unitsname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">units</span> <span class="o">?</span> <span class="s">&#39;data&#39;</span>
        <span class="k">continue</span>

      <span class="k">else</span>
        <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">@glyphspec</span><span class="p">[</span><span class="nx">attrname</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The glyph specification provided a string for this field; how we
interpret it depends on the type of the field.
For string fields, this becomes the field value.  For all others,
treat this as customizing the name of the field.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="nx">attrtype</span> <span class="o">==</span> <span class="s">&#39;string&#39;</span>
            <span class="nv">default_value = </span><span class="nx">@glyphspec</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span>
            <span class="nv">fieldname = </span><span class="nx">attrname</span>
          <span class="k">else</span>
            <span class="nv">default_value = </span><span class="nx">@styleprovider</span><span class="p">.</span><span class="nx">mget</span><span class="p">(</span><span class="nx">attrname</span><span class="p">)</span>
            <span class="nv">fieldname = </span><span class="nx">@glyphspec</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>In either case, use the default units</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">units = </span><span class="nx">@styleprovider</span><span class="p">.</span><span class="nx">mget</span><span class="p">(</span><span class="nx">unitsname</span><span class="p">)</span>
          <span class="nx">glyph</span><span class="p">[</span><span class="nx">unitsname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">units</span> <span class="o">?</span> <span class="s">&#39;data&#39;</span>

        <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">@glyphspec</span><span class="p">[</span><span class="nx">attrname</span><span class="p">])</span>
          <span class="nv">obj = </span><span class="nx">@glyphspec</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span>
          <span class="nv">fieldname = </span><span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">field</span><span class="o">?</span> <span class="k">then</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">field</span> <span class="k">else</span> <span class="nx">attrname</span>
          <span class="nv">default_value = </span><span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">default</span><span class="o">?</span> <span class="k">then</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">default</span> <span class="k">else</span> <span class="nx">@styleprovider</span><span class="p">.</span><span class="nx">mget</span><span class="p">(</span><span class="nx">attrname</span><span class="p">)</span>
          <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">units</span><span class="o">?</span>
            <span class="nx">glyph</span><span class="p">[</span><span class="nx">unitsname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">units</span>
          <span class="k">else</span>
            <span class="nv">units = </span><span class="nx">@styleprovider</span><span class="p">.</span><span class="nx">mget</span><span class="p">(</span><span class="nx">unitsname</span><span class="p">)</span>
            <span class="nx">glyph</span><span class="p">[</span><span class="nx">unitsname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">units</span> <span class="o">?</span> <span class="s">&#39;data&#39;</span>

        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>This is an error down here...</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;Unknown glyph specification value type.&quot;</span><span class="p">)</span>
          <span class="k">continue</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Both string and object glyphspecs share this logic</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">fieldname</span> <span class="k">of</span> <span class="nx">datapoint</span>
          <span class="nx">glyph</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">datapoint</span><span class="p">[</span><span class="nx">fieldname</span><span class="p">]</span>
        <span class="k">else</span>
          <span class="nx">glyph</span><span class="p">[</span><span class="nx">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">default_value</span>

    <span class="k">return</span> <span class="nx">glyph</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>class : GlyphRendererView</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">GlyphRendererView</span> <span class="k">extends</span> <span class="nx">Bokeh</span><span class="p">.</span><span class="nx">XYRendererView</span>
  <span class="nv">addSquare: </span><span class="nf">(x, y, size, color) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
      <span class="nx">reqturn</span> <span class="kc">null</span>
    <span class="vi">@plot_view.ctx.fillStyle = </span><span class="nx">color</span>
    <span class="vi">@plot_view.ctx.strokeStyle = </span><span class="nx">color</span>
    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">y</span> <span class="o">-</span> <span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>

  <span class="nv">addCircle: </span><span class="nf">(x, y, size, color, outline_color, alpha) -&gt;</span>
    <span class="nv">ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">outline_color</span><span class="o">?</span><span class="p">)</span>
      <span class="nv">outline_color = </span><span class="nx">color</span>
    <span class="k">if</span> <span class="nx">alpha</span><span class="o">?</span> <span class="o">and</span> <span class="p">(</span><span class="nx">alpha</span> <span class="o">!=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span><span class="p">)</span>
      <span class="nv">old_alpha = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span>
      <span class="nv">ctx.globalAlpha  = </span><span class="nx">alpha</span>
    <span class="nv">ctx.fillStyle = </span><span class="nx">color</span>
    <span class="nv">ctx.strokeStyle = </span><span class="nx">outline_color</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">size</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">alpha</span><span class="o">?</span>
      <span class="nv">ctx.globalAlpha = </span><span class="nx">old_alpha</span>

  <span class="nv">addRect : </span><span class="nf">(glyph, plot_view, left, right, bottom, top) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Internal method for actually drawing a rectangle
<strong>glyph</strong> contains some visual attributes, and <strong>plot<em>view</strong>
is typically @plot</em>view.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>TODO: We need to manually flip the Y axis coordinates</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">bottom = </span><span class="nx">plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">bottom</span><span class="p">)</span>
    <span class="nv">top = </span><span class="nx">plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">top</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>At this point, we have the box boundaries (left, right, bottom, top)
in screen space coordinates, and should be ready to draw.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>In the following, we need to grab the first element of the returned
valued b/c getter functions always return (val, units) and we don't
care about units for color.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ctx = </span><span class="nx">plot_view</span><span class="p">.</span><span class="nx">ctx</span>
    <span class="nv">old_alpha = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span>
    <span class="nv">old_linewidth = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span>
    <span class="nv">ctx.globalAlpha = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">alpha</span>
    <span class="nv">ctx.lineWidth = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">outline_width</span>
    <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">angle</span> <span class="o">!=</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>TODO: Fix angle handling. We need to translate, then rotate, then
reset the ctm. Probably best to do this with save() and restore()
b/c there doesn't seem to be a way to read out the current ctm.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">angle_units</span> <span class="o">==</span> <span class="s">&#39;deg&#39;</span>
        <span class="nv">angle = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">angle</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span>
      <span class="k">else</span>
        <span class="nv">angle = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">angle</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">color</span><span class="o">?</span> <span class="o">and</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">color</span> <span class="o">!=</span> <span class="s">&quot;none&quot;</span>
      <span class="nv">ctx.fillStyle = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">color</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">right</span><span class="o">-</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="o">-</span><span class="nx">bottom</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">outline_color</span><span class="o">?</span> <span class="o">and</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">outline_color</span> <span class="o">!=</span> <span class="s">&quot;none&quot;</span>
      <span class="nv">ctx.strokeStyle = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">outline_color</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">right</span><span class="o">-</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="o">-</span><span class="nx">bottom</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">angle</span><span class="o">?</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="o">-</span><span class="nx">angle</span><span class="p">)</span>
    <span class="nv">ctx.globalAlpha = </span><span class="nx">old_alpha</span>
    <span class="nv">ctx.lineWidth = </span><span class="nx">old_linewidth</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>method : GlyphRendererView::calc_screen</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">calc_screen : </span><span class="nf">(glyph, direction, datapoint, mapper) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h4>Parameters</h4>

<ul>
<li>glyph : one glyph such as  @mget('glyphs')[0]</li>
<li>direction : 'x' or 'y'</li>
<li>datapoint : one record from the data source, as a dictionary</li>
<li>mapper : the mapper which pertains to dim</li>
</ul>

<h4>Returns</h4>

<ul>
<li>screen coordinate</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>get dim, first from the glyph, otherwise from the glyph
renderer model. dims can either be strings to specify the field name
<code>"x"</code>, or <code>"stockprice"</code>, or they can be an array
<code>["stockprice", 0.10, 0.20]</code>  If the dim is an array, the
first element is the field name, and the 2 floats are
data space offset and screen space offset for the glyph</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dim = </span><span class="k">if</span> <span class="nx">glyph</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="k">then</span> <span class="nx">glyph</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="nx">direction</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">dim</span><span class="p">)</span>
      <span class="nv">data = </span><span class="nx">datapoint</span><span class="p">[</span><span class="nx">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
      <span class="nv">data = </span><span class="k">if</span> <span class="nx">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">then</span> <span class="nx">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">data</span> <span class="k">else</span> <span class="nx">data</span>
      <span class="nv">screenoffset = </span><span class="k">if</span> <span class="nx">dim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">then</span> <span class="nx">dim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">else</span>
      <span class="nv">data = </span><span class="nx">datapoint</span><span class="p">[</span><span class="nx">dim</span><span class="p">]</span>
      <span class="nv">screenoffset = </span><span class="mi">0</span>
    <span class="k">if</span> <span class="nx">dim</span> <span class="o">==</span> <span class="s">&#39;x&#39;</span>
      <span class="nv">screenoffset = </span><span class="nx">screenoffset</span> <span class="o">*</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">screenoffset = </span><span class="nx">screenoffset</span> <span class="o">*</span> <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>
    <span class="nv">screen = </span><span class="nx">mapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">+</span> <span class="nx">screenoffset</span>
    <span class="k">return</span> <span class="nx">screen</span>

  <span class="nv">render_scatter : </span><span class="nf">(glyph, data) -&gt;</span>
    <span class="nv">datapoint = </span><span class="nx">data</span><span class="p">[</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
    <span class="nv">screenx = </span><span class="nx">@calc_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="nx">datapoint</span><span class="p">,</span> <span class="nx">@xmapper</span><span class="p">)</span>
    <span class="nv">screeny = </span><span class="nx">@calc_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="nx">datapoint</span><span class="p">,</span> <span class="nx">@ymapper</span><span class="p">)</span>
    <span class="nv">size = </span><span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">size</span> <span class="k">then</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">size</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;scatter_size&#39;</span><span class="p">)</span>
    <span class="nv">color = </span><span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">color</span> <span class="k">then</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">color</span> <span class="k">else</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;color&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;circle&#39;</span>
      <span class="nx">@addCircle</span><span class="p">(</span><span class="nx">screenx</span><span class="p">,</span> <span class="nx">screeny</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;square&#39;</span>
      <span class="nx">@addSquare</span><span class="p">(</span><span class="nx">screenx</span><span class="p">,</span> <span class="nx">screeny</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span>

  <span class="nv">render : </span><span class="o">-&gt;</span>
    <span class="nv">screen_glpyhs = </span><span class="p">[]</span>
    <span class="nv">source = </span><span class="nx">@mget_obj</span><span class="p">(</span><span class="s">&#39;data_source&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">source</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&quot;ObjectArrayDataSource&quot;</span>
      <span class="nv">data = </span><span class="nx">source</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">source</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&quot;ColumnDataSource&quot;</span>
      <span class="nv">data = </span><span class="nx">source</span><span class="p">.</span><span class="nx">datapoints</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">glyph</span> <span class="k">in</span> <span class="nx">@mget</span><span class="p">(</span><span class="s">&#39;glyphs&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;circle&#39;</span> <span class="o">or</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;square&#39;</span>
        <span class="nx">@render_scatter</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;circles&#39;</span>
        <span class="nx">@render_circles</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;rects&#39;</span>
        <span class="nx">@render_rects</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;rectregions&#39;</span>
        <span class="nx">@render_rectregions</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;line&#39;</span>
        <span class="nx">@render_line</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;area&#39;</span>
        <span class="nx">@render_area</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;stacked_lines&#39;</span>
        <span class="nx">@render_stacked_lines</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;stacked_rects&#39;</span>
        <span class="nx">@render_stacked_rects</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s">&#39;boxplots&#39;</span>
        <span class="nx">@render_boxplots</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>


  <span class="nv">render_line : </span><span class="nf">(glyphspec, data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>Fields of the <code>line</code> glyph:</h3>

<ul>
<li>x, y</li>
<li>line_width</li>
<li>line_color</li>
<li>alpha</li>
</ul>

<p>Note that unlike other glyphs, the aesthetic parameters canont be
changed on a per-datapoint basis.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">metaglyph = </span><span class="k">new</span> <span class="nx">MetaGlyph</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">glyphspec</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;line_width:string&#39;</span><span class="p">,</span> <span class="s">&#39;line_color:string&#39;</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">])</span>

    <span class="nv">ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Since we do not allow override of any of the aesthetic parameters
from point to point, we just take the values off of the first_glyph.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">first_glyph = </span><span class="nx">metaglyph</span><span class="p">.</span><span class="nx">make_glyph</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nv">ctx.lineWidth = </span><span class="nx">first_glyph</span><span class="p">.</span><span class="nx">line_width</span>
    <span class="nv">ctx.strokeStyle = </span><span class="nx">first_glyph</span><span class="p">.</span><span class="nx">line_color</span>
    <span class="nv">ctx.globalAlpha = </span><span class="nx">first_glyph</span><span class="p">.</span><span class="nx">alpha</span>

    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="nv">glyph = </span><span class="nx">metaglyph</span><span class="p">.</span><span class="nx">make_glyph</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span>
      <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="o">?</span> <span class="o">and</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span><span class="o">?</span><span class="p">)</span>
        <span class="k">continue</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">x_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">sx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span>
      <span class="k">else</span>
        <span class="nv">sx = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">y_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">sy = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>
      <span class="k">else</span>
        <span class="nv">sy = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span>

      <span class="k">if</span> <span class="nx">idx</span> <span class="o">==</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>First glyph, start the path</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>
        <span class="k">continue</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">sx</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">sy</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="k">continue</span>
      <span class="k">else</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

  <span class="nv">render_stacked_lines : </span><span class="nf">(glyphspec, data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>Fields of the <code>line</code> glyph:</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>

    <span class="nv">accum = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">pt</span> <span class="k">in</span> <span class="nx">data</span>
      <span class="nx">accum</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">yidx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..(</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>render the area</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">ctx.lineWidth = </span><span class="mi">0</span>
      <span class="nv">ctx.fillStyle = </span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">fills</span><span class="p">[</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="nx">yidx</span><span class="p">]].</span><span class="nx">fill_color</span>
      <span class="nv">ctx.globalAlpha = </span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">fills</span><span class="p">[</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="nx">yidx</span><span class="p">]].</span><span class="nx">fill_alpha</span>
      <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nv">sx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">x</span><span class="p">))</span>
        <span class="nv">sy = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">accum</span><span class="p">[</span><span class="nx">idx</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nx">idx</span> <span class="o">==</span> <span class="mi">0</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>
      <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)..</span><span class="mi">0</span><span class="p">]</span>
        <span class="nv">y = </span><span class="nx">accum</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">+</span> <span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="p">][</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="nx">yidx</span><span class="p">]]</span>
        <span class="nv">sx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">x</span><span class="p">))</span>
        <span class="nv">sy = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span>
        <span class="nx">accum</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>render the line</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">ctx.lineWidth = </span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">lines</span><span class="p">[</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="nx">yidx</span><span class="p">]].</span><span class="nx">line_width</span>
      <span class="nv">ctx.strokeStyle = </span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">lines</span><span class="p">[</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="nx">yidx</span><span class="p">]].</span><span class="nx">line_color</span>
      <span class="nv">ctx.globalAlpha = </span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">lines</span><span class="p">[</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="nx">yidx</span><span class="p">]].</span><span class="nx">line_alpha</span>
      <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nv">sx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">x</span><span class="p">))</span>
        <span class="nv">sy = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">accum</span><span class="p">[</span><span class="nx">idx</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nx">idx</span> <span class="o">==</span> <span class="mi">0</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>
          <span class="k">continue</span>
        <span class="k">else</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

  <span class="nv">render_stacked_rects : </span><span class="nf">(glyphspec, data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h3>Fields of the <code>line</code> glyph:</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">rectdata = </span><span class="p">[]</span>

    <span class="nv">glyph = </span><span class="p">{</span>
      <span class="nv">type: </span><span class="s">&#39;rects&#39;</span>
      <span class="nv">x: </span><span class="s">&#39;x&#39;</span>
      <span class="nv">color:</span>
        <span class="nv">field: </span><span class="s">&#39;color&#39;</span>
    <span class="p">}</span>

    <span class="nv">accum = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">pt</span> <span class="k">in</span> <span class="nx">data</span>
      <span class="nx">accum</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nv">width = </span><span class="mf">0.2</span> <span class="c1"># TODO</span>

    <span class="k">for</span> <span class="nx">yidx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..(</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
      <span class="nv">color = </span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">fills</span><span class="p">[</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="nx">yidx</span><span class="p">]].</span><span class="nx">fill_color</span>
      <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nv">x = </span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">x</span>
        <span class="nv">height = </span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="p">][</span><span class="nx">glyphspec</span><span class="p">.</span><span class="nx">y</span><span class="p">[</span><span class="nx">yidx</span><span class="p">]]</span>
        <span class="nv">y = </span><span class="nx">accum</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">+</span> <span class="nx">height</span><span class="o">/</span><span class="mi">2</span>
        <span class="nx">accum</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nx">accum</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">+</span> <span class="nx">height</span>
        <span class="nv">pt = </span><span class="p">{}</span>
        <span class="nx">pt</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span>
        <span class="nx">pt</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span>
        <span class="nx">pt</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">width</span>
        <span class="nx">pt</span><span class="p">[</span><span class="s">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">height</span>
        <span class="nx">pt</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">color</span>
        <span class="nx">rectdata</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pt</span><span class="p">)</span>

    <span class="nx">@render_rects</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">rectdata</span><span class="p">)</span>

  <span class="nv">render_circles : </span><span class="nf">(glyphspec, data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h3>Fields of the <code>circles</code> glyph:</h3>

<ul>
<li>x, y: the center of the glyph</li>
<li>radius: radius in data or screen coords</li>
<li>color</li>
<li>outline_color</li>
<li>outline_width</li>
<li>alpha</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">metaglyph = </span><span class="k">new</span> <span class="nx">MetaGlyph</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">glyphspec</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;radius&quot;</span><span class="p">,</span> <span class="s">&quot;color:string&quot;</span><span class="p">,</span> <span class="s">&quot;outline_color:string&quot;</span><span class="p">,</span> <span class="s">&quot;outline_width&quot;</span><span class="p">,</span> <span class="s">&quot;alpha&quot;</span><span class="p">])</span>

    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">datapoint</span> <span class="k">in</span> <span class="nx">data</span>
      <span class="nv">glyph = </span><span class="nx">metaglyph</span><span class="p">.</span><span class="nx">make_glyph</span><span class="p">(</span><span class="nx">datapoint</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Instead of calling @calc_screen and supporting offsets, we just bake
that logic into the loop here.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">sx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">x_units</span> <span class="o">==</span> <span class="s">&#39;screen&#39;</span> <span class="k">then</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span> <span class="k">else</span> <span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span>
      <span class="nv">sy = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">y_units</span> <span class="o">==</span> <span class="s">&#39;screen&#39;</span> <span class="k">then</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span> <span class="k">else</span> <span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>

      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">radius_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Use of span2bounds is a tiny bit hackish, because it assumes the
span is specified as (center,width). In our case, we don't care
about center.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">[</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">units</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_span2bounds</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">x_units</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">radius</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">radius_units</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
          <span class="nv">left = </span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">left</span><span class="p">)</span>
          <span class="nv">right = </span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">right</span><span class="p">)</span>
        <span class="nv">size = </span><span class="nx">right</span> <span class="o">-</span> <span class="nx">left</span>
      <span class="k">else</span>
        <span class="nv">size = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">radius</span>

      <span class="nv">ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span>
      <span class="nv">old_linewidth = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span>
      <span class="nv">ctx.lineWidth = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">outline_width</span>
      <span class="nx">@addCircle</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">color</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">outline_color</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">alpha</span><span class="p">)</span>
      <span class="nv">ctx.lineWidth = </span><span class="nx">old_linewidth</span>

    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

  <span class="nv">render_area : </span><span class="nf">(glyphspec, data) -&gt;</span>
    <span class="nv">metaglyph = </span><span class="k">new</span> <span class="nx">MetaGlyph</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">glyphspec</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;color:string&#39;</span><span class="p">,</span> <span class="s">&#39;outline_width:string&#39;</span><span class="p">,</span> <span class="s">&#39;outline_color:string&#39;</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">])</span>

    <span class="nv">ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Since we do not allow override of any of the aesthetic parameters
from point to point, we just take the values off of the first_glyph.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">first_glyph = </span><span class="nx">metaglyph</span><span class="p">.</span><span class="nx">make_glyph</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nv">ctx.fillStyle = </span><span class="nx">first_glyph</span><span class="p">.</span><span class="nx">color</span>
    <span class="nv">ctx.lineWidth = </span><span class="nx">first_glyph</span><span class="p">.</span><span class="nx">outline_width</span>
    <span class="nv">ctx.strokeStyle = </span><span class="nx">first_glyph</span><span class="p">.</span><span class="nx">outline_color</span>
    <span class="nv">ctx.globalAlpha = </span><span class="nx">first_glyph</span><span class="p">.</span><span class="nx">alpha</span>

    <span class="k">for</span> <span class="nx">idx</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="nv">glyph = </span><span class="nx">metaglyph</span><span class="p">.</span><span class="nx">make_glyph</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span>
      <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="o">?</span> <span class="o">and</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span><span class="o">?</span><span class="p">)</span>
        <span class="k">continue</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">x_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">sx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span>
      <span class="k">else</span>
        <span class="nv">sx = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">y_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">sy = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>
      <span class="k">else</span>
        <span class="nv">sy = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span>

      <span class="k">if</span> <span class="nx">idx</span> <span class="o">==</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>First glyph, start the path</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>
        <span class="k">continue</span>

      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span> <span class="nx">sy</span><span class="p">)</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

  <span class="nv">render_rects : </span><span class="nf">(glyphspec, data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>A rectangle, specified by a center and width &amp; height.</p>

<h2>Spatial parameters</h2>

<ul>
<li>x, y, width, height</li>
<li>angle</li>
</ul>

<p>For each of these spatial parameters, the full specification in the
glyph is an embedded object with the following properties:
* field: the name of the field in each data point; this defaults to
    the name of the spatial parameter itself (e.g. 'height', 'bottom', 'x')
* default: a numerical default value to use if the field does not exist
    on a datapoint.  Each spatial parameter also has a global default
    value (defined in GlyphRenderer::display_defaults)
* units: For all parameters except 'angle', this specifies the coordinate
    space in which to interpret data values, either 'data' (default) or
    'screen'. For the 'angle' parameter, this property is either 'deg' or
    'rad'.</p>

<p>Example:
  type: 'rects'
  x:
    field: 'var1'
    units: 'data'
  y:
    field: 'var2'
    default: 10
    units: screen</p>

<p>However, a shorthand can be used if only the field name needs to be
specified, or a constant default numerical value is to be used.</p>

<p>Example:
  type: 'rects'
  width: 'var3' # shorthand for field:'var3'
  height: 8     # shorthand for default:8, units:'data'</p>

<p>If a numerical default value is specified, it can still be overridden on
a per-datapoint basis since the GlyphRenderer::display_defaults specify
default field names for each of these properties.  In the example above,
if a datapoint had an additional field named 'height', which is the default
field name for the height parameter, then it would override the constant
value of 8.</p>

<p>For colors and other properties which can accept string values, there is
potential ambiguity in the shorthand form:
  type: 'rects'
  color: 'red'</p>

<p>Does this mean that the default value of <code>color</code> should be <code>'red'</code>, or
that the field named <code>'red'</code> should be used to determine the color of
each datapoint?  To resolve this, for colors, the shorthand is
interpreted to mean the former, because this is such a common case.  To
specify the fieldname for color-related properties, use the long form:</p>

<p>type: 'rects'
  color:
    field: 'colorfieldname'</p>

<h2>Other parameters</h2>

<ul>
<li>color: fill color</li>
<li>outline_color: outline/stroke color</li>
<li>outline_width: outline thickness in screen pixels</li>
<li>alpha: alpha value (0..1) for entire glyph.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>TODO: This checking for the 'x' or 'left' parameter of the Glyph spec
is brittle and behaves poorly; perhaps the user omits these fields
altogether?  Need a better way to specify this, perhaps an explicit
parameter.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">params = </span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;width&#39;</span><span class="p">,</span><span class="s">&#39;height&#39;</span><span class="p">]</span>

    <span class="nx">params</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;angle&quot;</span><span class="p">,</span> <span class="s">&quot;color:string&quot;</span><span class="p">,</span> <span class="s">&quot;outline_color:string&quot;</span><span class="p">,</span><span class="s">&quot;alpha&quot;</span><span class="p">,</span> <span class="s">&quot;outline_width&quot;</span><span class="p">])</span>
    <span class="nv">metaglyph = </span><span class="k">new</span> <span class="nx">MetaGlyph</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">glyphspec</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>

    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">datapoint</span> <span class="k">in</span> <span class="nx">data</span>
      <span class="nv">glyph = </span><span class="nx">metaglyph</span><span class="p">.</span><span class="nx">make_glyph</span><span class="p">(</span><span class="nx">datapoint</span><span class="p">)</span>
      <span class="p">[</span><span class="nx">left</span><span class="p">,</span><span class="nx">right</span><span class="p">,</span><span class="nx">h_units</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_span2bounds</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">x_units</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">width_units</span><span class="p">,</span> <span class="nx">@xmapper</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">h_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">left = </span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">left</span><span class="p">)</span>
        <span class="nv">right = </span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">right</span><span class="p">)</span>
      <span class="p">[</span><span class="nx">bottom</span><span class="p">,</span><span class="nx">top</span><span class="p">,</span><span class="nx">v_units</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_span2bounds</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">y_units</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">height_units</span><span class="p">,</span> <span class="nx">@ymapper</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">v_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">bottom = </span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">bottom</span><span class="p">)</span>
        <span class="nv">top = </span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">top</span><span class="p">)</span>

      <span class="nx">@addRect</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">@plot_view</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>End per-datapoint loop</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Done with all drawing, restore the graphics state</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>
    <span class="k">return</span>      <span class="c1"># render_rects()</span>

  <span class="nv">render_rectregions : </span><span class="nf">(glyphspec, data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Rectangles, specified by their edges (left, right, bottom, top).</p>

<h2>Spatial parameters</h2>

<ul>
<li>left, right, bottom, top</li>
<li>angle</li>
</ul>

<p>The treatment of these parameters is the same as in render_rects,
that is, there is a full object specification in the glyph, with a
shorthand if only the field name or a constant numerical value needs
to be used.</p>

<p>Example:
  type: 'rectregions'
  left: 'left'
  bottom:
    field: "foo"
    default: 1.8
    units: "data"</p>

<h2>Other parameters</h2>

<p>These are identical to the parameters of the "rects" glyph.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">params = </span><span class="p">[</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="s">&#39;top&#39;</span><span class="p">]</span>

    <span class="nx">params</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;angle&quot;</span><span class="p">,</span> <span class="s">&quot;color:string&quot;</span><span class="p">,</span> <span class="s">&quot;outline_color:string&quot;</span><span class="p">,</span><span class="s">&quot;alpha&quot;</span><span class="p">,</span> <span class="s">&quot;outline_width&quot;</span><span class="p">])</span>
    <span class="nv">metaglyph = </span><span class="k">new</span> <span class="nx">MetaGlyph</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">glyphspec</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>

    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">datapoint</span> <span class="k">in</span> <span class="nx">data</span>
      <span class="nv">glyph = </span><span class="nx">metaglyph</span><span class="p">.</span><span class="nx">make_glyph</span><span class="p">(</span><span class="nx">datapoint</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">left_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">left = </span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">right_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">right = </span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">right</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">bottom_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">bottom = </span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">bottom</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">top_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">top = </span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span>
      <span class="nx">@addRect</span><span class="p">(</span><span class="nx">glyph</span><span class="p">,</span> <span class="nx">@plot_view</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">,</span> <span class="nx">bottom</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Done with all drawing, restore the graphics state</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>
    <span class="k">return</span>      <span class="c1"># render_rect_regions()</span>

  <span class="nv">render_boxplots : </span><span class="nf">(glyphspec, data) -&gt;</span>
    <span class="nv">metaglyph = </span><span class="k">new</span> <span class="nx">MetaGlyph</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">glyphspec</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;median&#39;</span><span class="p">,</span> <span class="s">&#39;size&#39;</span><span class="p">,</span> <span class="s">&#39;q1&#39;</span><span class="p">,</span> <span class="s">&#39;q3&#39;</span><span class="p">])</span>

    <span class="nv">ctx = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">ctx</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>

    <span class="nv">ctx.fillStyle = </span><span class="s">&#39;lightblue&#39;</span>
    <span class="nv">ctx.lineWidth = </span><span class="mf">1.0</span>
    <span class="nv">ctx.strokeStyle = </span><span class="s">&#39;orange&#39;</span>
    <span class="nv">ctx.globalAlpha = </span><span class="mf">1.0</span>

    <span class="k">for</span> <span class="nx">datapoint</span> <span class="k">in</span> <span class="nx">data</span>
      <span class="nv">glyph = </span><span class="nx">metaglyph</span><span class="p">.</span><span class="nx">make_glyph</span><span class="p">(</span><span class="nx">datapoint</span><span class="p">)</span>

      <span class="nv">iqr = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">q3</span> <span class="o">-</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">q1</span>

      <span class="nv">x = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span>
      <span class="nv">ym = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">median</span><span class="p">))</span>
      <span class="nv">yq1 = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">q1</span><span class="p">))</span>
      <span class="nv">yq3 = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">q3</span><span class="p">))</span>
      <span class="nv">yl = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">q1</span> <span class="o">-</span> <span class="mf">1.5</span><span class="o">*</span><span class="nx">iqr</span><span class="p">))</span>
      <span class="nv">yu = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">ypos</span><span class="p">(</span><span class="nx">@ymapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">q3</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="nx">iqr</span><span class="p">))</span>

      <span class="nv">half_size = </span><span class="nx">glyph</span><span class="p">.</span><span class="nx">size</span><span class="o">/</span><span class="mf">2.0</span>
      <span class="nv">whisker_half_size = </span><span class="nx">half_size</span><span class="o">*</span><span class="mf">0.8</span>
      <span class="k">if</span> <span class="nx">glyph</span><span class="p">.</span><span class="nx">size_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
        <span class="nv">x0 = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="o">-</span><span class="nx">half_size</span><span class="p">))</span>
        <span class="nv">x1 = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">half_size</span><span class="p">))</span>
        <span class="nv">xw0 = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="o">-</span><span class="nx">whisker_half_size</span><span class="p">))</span>
        <span class="nv">xw1 = </span><span class="nx">@plot_view</span><span class="p">.</span><span class="nx">viewstate</span><span class="p">.</span><span class="nx">xpos</span><span class="p">(</span><span class="nx">@xmapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">whisker_half_size</span><span class="p">))</span>
      <span class="k">else</span>
        <span class="nv">x0 = </span><span class="nx">x</span> <span class="o">-</span> <span class="nx">half_size</span>
        <span class="nv">x1 = </span><span class="nx">x</span> <span class="o">+</span> <span class="nx">half_size</span>
        <span class="nv">xw0 = </span><span class="nx">x</span> <span class="o">-</span> <span class="nx">whisker_half_size</span>
        <span class="nv">xw1 = </span><span class="nx">x</span> <span class="o">+</span> <span class="nx">whisker_half_size</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>upper box</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x0</span><span class="p">,</span> <span class="nx">yq3</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">yq3</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">ym</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x0</span><span class="p">,</span> <span class="nx">ym</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>lower box</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x0</span><span class="p">,</span> <span class="nx">yq1</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">yq1</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">ym</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x0</span><span class="p">,</span> <span class="nx">ym</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>centerline</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x0</span><span class="p">,</span> <span class="nx">ym</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">ym</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>upper line</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">yq3</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">yu</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>lower line</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">yq1</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">yl</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>upper whisker</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">xw0</span><span class="p">,</span> <span class="nx">yu</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">xw1</span><span class="p">,</span> <span class="nx">yu</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>lower whisker</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">xw0</span><span class="p">,</span> <span class="nx">yl</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">xw1</span><span class="p">,</span> <span class="nx">yl</span><span class="p">)</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

  <span class="nv">_span2bounds : </span><span class="nf">(center, center_units, span, span_units, mapper) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Given a center value and a span value of potentially different
spaces, returns an tuple (min, max, units) normalizing them
into the space space ('data' or 'screen'), via the given mapper.
NB: The mapper must be able to map from screen to data space.
TODO: This function should probably be moved onto the Mappers.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">halfspan = </span><span class="nx">span</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="nx">center_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span> <span class="o">and</span> <span class="nx">span_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">center</span><span class="o">-</span><span class="nx">halfspan</span><span class="p">,</span> <span class="nx">center</span><span class="o">+</span><span class="nx">halfspan</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">center_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span> <span class="o">and</span> <span class="nx">span_units</span> <span class="o">==</span> <span class="s">&#39;screen&#39;</span>
      <span class="nv">center_s = </span><span class="nx">mapper</span><span class="p">.</span><span class="nx">map_screen</span><span class="p">(</span><span class="nx">center</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">center_s</span><span class="o">-</span><span class="nx">halfspan</span><span class="p">,</span> <span class="nx">center_s</span><span class="o">+</span><span class="nx">halfspan</span><span class="p">,</span> <span class="s">&#39;screen&#39;</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">center_units</span> <span class="o">==</span> <span class="s">&#39;screen&#39;</span> <span class="o">and</span> <span class="nx">span_units</span> <span class="o">==</span> <span class="s">&#39;data&#39;</span>
      <span class="nv">center_d = </span><span class="nx">mapper</span><span class="p">.</span><span class="nx">map_data</span><span class="p">(</span><span class="nx">center</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">center_d</span><span class="o">-</span><span class="nx">halfspan</span><span class="p">,</span> <span class="nx">centerd</span><span class="o">+</span><span class="nx">halfspan</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">center_units</span> <span class="o">==</span> <span class="s">&#39;screen&#39;</span> <span class="o">and</span> <span class="nx">span_units</span> <span class="o">==</span> <span class="s">&#39;screen&#39;</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">center</span><span class="o">-</span><span class="nx">halfspan</span><span class="p">,</span> <span class="nx">center</span><span class="o">+</span><span class="nx">halfspan</span><span class="p">,</span> <span class="s">&#39;screen&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <h3>class : GlyphRenderer</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">GlyphRenderer</span> <span class="k">extends</span> <span class="nx">HasParent</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Example definition</p>

<pre><code>data_source : data_source.ref()
xdata_range : xdr.ref()
ydata_range : ydr.ref()
scatter_size : 10
color : 'black'
x : 'x'
y : 'y'
glyphs : [
    type : 'circle'
    index : 0
  ,
    type : 'square'
    index : 1
  ,
    type : 'square'
    index : 2
    color : 'red'
  ,
    type : 'square'
    index : 2
    color : 'green'
    x : ['x', 0, 0.1]
  ,
    type : 'square'
    index : 2
    color : 'green'
    x : ['x', 0, -0.1]
]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">type : </span><span class="s">&#39;GlyphRenderer&#39;</span>
  <span class="nv">default_view : </span><span class="nx">GlyphRendererView</span>

<span class="nv">GlyphRenderer::defaults = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">GlyphRenderer</span><span class="o">::</span><span class="nx">defaults</span><span class="p">)</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">GlyphRenderer</span><span class="o">::</span><span class="nx">defaults</span><span class="p">,</span>
  <span class="nv">data_source : </span><span class="kc">null</span>
  <span class="nv">scatter_size : </span><span class="mi">3</span>
  <span class="nv">color : </span><span class="s">&#39;black&#39;</span>
<span class="p">)</span>

<span class="nv">GlyphRenderer::display_defaults = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">GlyphRenderer</span><span class="o">::</span><span class="nx">display_defaults</span><span class="p">)</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">GlyphRenderer</span><span class="o">::</span><span class="nx">display_defaults</span><span class="p">,</span> <span class="p">{</span>
  <span class="nv">radius : </span><span class="mi">5</span>
  <span class="nv">radius_units: </span><span class="s">&#39;screen&#39;</span>
  <span class="nv">color : </span><span class="s">&#39;gray&#39;</span>
  <span class="nv">outline_color: </span><span class="s">&#39;none&#39;</span>
  <span class="nv">outline_width: </span><span class="mi">1</span>

  <span class="nv">angle_units: </span><span class="s">&#39;deg&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Rects glyph</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">height: </span><span class="mi">1</span>
  <span class="nv">width: </span><span class="mi">1</span>
  <span class="nv">top: </span><span class="mi">1</span>
  <span class="nv">bottom: </span><span class="mi">0</span>
  <span class="nv">left: </span><span class="mi">0</span>
  <span class="nv">right: </span><span class="mi">1</span>

<span class="p">})</span>

<span class="k">class</span> <span class="nx">GlyphRenderers</span> <span class="k">extends</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">Collection</span>
  <span class="nv">model : </span><span class="nx">GlyphRenderer</span>

<span class="k">if</span> <span class="o">not</span> <span class="nx">Continuum</span><span class="p">.</span><span class="nx">Collections</span><span class="p">.</span><span class="nx">GlyphRenderer</span>
  <span class="nv">Continuum.Collections.GlyphRenderer = </span><span class="k">new</span> <span class="nx">GlyphRenderers</span>
<span class="nv">Bokeh.GlyphRendererView = </span><span class="nx">GlyphRendererView</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 